import{l as F,r as u,d as b,b as O,c as x,o as l,w as T,k as U,a as e,f as d,i as N,v as $,g as P,F as _,p as k,t as p}from"./app-U24E4X8J.js";import{P as z}from"./ProviderDashboardLayout-DUza5JUE.js";import{D as A}from"./DateRangePicker-D9uIVrT9.js";import"./NotificationDropdown-C1vcB40o.js";import"./x-DORMN0nV.js";const E={class:"p-6 bg-white rounded-xl shadow-sm border border-gray-200"},G={class:"flex flex-col sm:flex-row justify-between gap-4 mb-6"},J={class:"flex items-center w-full sm:w-1/3 border border-gray-300 rounded-lg px-3 py-2"},q={class:"flex gap-2"},H={class:"relative"},K=["value"],Q={key:0},W={class:"text-lg font-semibold text-gray-800 mb-3"},X={class:"divide-y divide-gray-100"},Y=["onClick"],Z={class:"flex items-center space-x-3"},ee=["src"],te={class:"font-medium text-gray-800 truncate"},oe={class:"text-gray-600 text-sm"},se={class:"text-gray-600 text-sm"},re={class:"text-gray-800 font-medium"},ae={key:1,class:"text-center py-10 text-gray-500"},ne={__name:"Invoices",setup(le){const C=JSON.parse(localStorage.getItem("userData")||"{}").id,w=u({}),m=u(""),c=u(!1),a=u({start:null,end:null}),g=u({start:null,end:null}),D=async()=>{try{const o=await U.post("/get-invoices",{provider_id:C});o.data.success&&(w.value=o.data.data)}catch(o){console.error("Error fetching invoices:",o)}},S=()=>c.value=!c.value,j=()=>{a.value.start&&a.value.end&&(g.value={...a.value})},I=()=>{a.value={start:null,end:null},g.value={start:null,end:null}},L=b(()=>{const o=a.value.start,t=a.value.end;return!o||!t?"":`${o.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})} - ${t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}`}),y=b(()=>{const o=m.value.toLowerCase(),t=g.value.start,s=g.value.end,n={};for(const[r,i]of Object.entries(w.value)){const h=i.filter(v=>{const B=v.customer_name.toLowerCase().includes(o),V=v.total_price.toString().includes(o),f=v.booking_date?new Date(v.booking_date):null,M=!t||!s||!f||f>=t&&f<=s;return(B||V)&&M});h.length>0&&(n[r]=h)}return n}),R=async(o,t)=>{try{const s=localStorage.getItem("authToken"),n=await fetch("https://donderstorm.com/api/download-invoice",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,Accept:"application/pdf"},body:JSON.stringify({booking_id:o,booking_type:t})});if(!n.ok)throw new Error("Failed to download invoice");const r=await n.blob(),i=window.URL.createObjectURL(r);window.open(i,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(i),100)}catch(s){console.error("Error downloading invoice:",s),alert("Failed to download invoice. Please try again.")}};return O(D),(o,t)=>(l(),x(z,null,{default:T(()=>[e("div",E,[t[6]||(t[6]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"Invoices"),e("p",{class:"text-gray-500"},"Keep all your invoices organised in one place.")],-1)),e("div",G,[e("div",J,[t[3]||(t[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 text-gray-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"})],-1)),N(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),type:"text",placeholder:"Search name, amount",class:"w-full outline-none text-gray-700 placeholder-gray-400"},null,512),[[$,m.value]])]),e("div",q,[e("div",H,[e("input",{type:"text",readonly:"",onClick:S,value:L.value,placeholder:"Select date range",class:"w-full sm:w-60 border border-gray-300 rounded-lg px-3 py-2 text-gray-700 cursor-pointer"},null,8,K),t[4]||(t[4]=e("svg",{class:"absolute right-3 top-2.5 w-5 h-5 text-gray-500 pointer-events-none",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),c.value?(l(),x(A,{key:0,modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value=s),show:c.value,onClose:t[2]||(t[2]=s=>c.value=!1),extraClasses:"top-full right-0 mt-2"},null,8,["modelValue","show"])):P("",!0)]),e("button",{onClick:j,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"}," Apply "),e("button",{onClick:I,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors"}," Reset ")])]),y.value&&Object.keys(y.value).length?(l(),d("div",Q,[(l(!0),d(_,null,k(y.value,(s,n)=>(l(),d("div",{key:n,class:"mb-8"},[e("h2",W,p(n),1),t[5]||(t[5]=e("div",{class:"grid grid-cols-4 font-semibold text-gray-600 text-sm border-b border-gray-200 pb-3 mb-2"},[e("div",null,"Customer Name"),e("div",null,"Total Services"),e("div",null,"Date"),e("div",null,"Total Amount")],-1)),e("div",X,[(l(!0),d(_,null,k(s,(r,i)=>(l(),d("div",{key:i,onClick:h=>R(r.id,r.booking_type),class:"grid grid-cols-4 items-center py-3 hover:bg-gray-50 transition cursor-pointer"},[e("div",Z,[e("img",{src:r.customer_profile_image||"https://static.vecteezy.com/system/resources/previews/036/594/092/non_2x/man-empty-avatar-photo-placeholder-for-social-networks-resumes-forums-and-dating-sites-male-and-female-no-photo-images-for-unfilled-user-profile-free-vector.jpg",class:"w-10 h-10 rounded-full object-cover border border-gray-200",alt:"User"},null,8,ee),e("span",te,p(r.customer_name),1)]),e("div",oe,p(r.services.length)+" Services ",1),e("div",se,p(r.booking_date||"—"),1),e("div",re," £"+p(r.total_price.toFixed(2)),1)],8,Y))),128))])]))),128))])):(l(),d("div",ae," No invoices found for this period. "))])]),_:1}))}},ve=F(ne,[["__scopeId","data-v-ea476c16"]]);export{ve as default};
