import{r as u,d as C,e as M,b as B,z as _,c as $,o as y,w as E,u as F,a as t,f as T,g as L,t as v,h as H,F as U,p as j,i as K,A as V,q as W,v as G,n as A,k as P}from"./app-DNlZ5eWp.js";import{_ as Z}from"./AuthLayout-Dv6pFKLM.js";const J={class:"w-full max-w-md mx-auto"},Y={class:"text-center mb-8"},Q={class:"text-gray-600"},X={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},ee={class:"flex items-start"},te={class:"text-sm"},se={key:1,class:"mb-4 p-3 bg-green-50 text-green-700 rounded-lg"},ae={class:"flex items-start"},oe={class:"text-sm"},re={class:"flex justify-center space-x-3"},ne=["onUpdate:modelValue","onInput","onKeydown"],le=["disabled"],ie={class:"mt-6 text-center"},ue={class:"text-gray-600"},de=["disabled"],pe={__name:"SignupOTPVerification",props:{userType:{type:String,required:!0}},setup(N){const k=M(),O=F(),p=N,i=u(["","","",""]),b=u(!1),h=u(!1),s=u(""),x=u(""),d=u(0),f=u([]),m=C(()=>k.query.countryCode||""),c=C(()=>k.query.mobile||""),S=(o,e)=>{const n=e.target.value;if(!/^\d*$/.test(n)){i.value[o]="";return}n&&o<i.value.length-1&&_(()=>{f.value[o+1].focus()})},I=o=>{!i.value[o]&&o>0&&_(()=>{f.value[o-1].focus()})},q=async()=>{var e,n,r;const o=i.value.join("");if(o.length!==4){s.value="Please enter a valid 4-digit OTP";return}b.value=!0,s.value="",x.value="";try{const l=p.userType==="garage"?"/provider/verify-otp":"/verify-otp",g={country_code:m.value,mobile:c.value,otp:o,fcm_token:"eOJLsFzYdUeimHNV8fY_m8:APA91bHiKHyu4IZdPLIPuAcUeWw_85-ieyNT3oRvFHMbVeL9_nG7zCpi51eEvyybZiN8GEsHxOvzlvuVBypruqxd-n4q6aZhyi58ucpeGTDWLiSXU8BQaH8"};console.log("Verifying OTP with data:",g);const a=await P.post(l,g);if(console.log("OTP verification response:",a.data),a.data&&a.data.success){const w=a.data.token||((e=a.data.data)==null?void 0:e.token);w&&(localStorage.setItem("authToken",w),P.setAuthToken(w)),(n=a.data.data)!=null&&n.provider&&localStorage.setItem("userData",JSON.stringify(a.data.data.provider)),x.value="OTP verified successfully!",setTimeout(()=>{O.push({path:p.userType==="garage"?"/signup/business-info/garage":`/signup/email/${p.userType}`,query:{contact:c.value,countryCode:m.value,mobile:c.value}})},1500)}else a.data&&a.data.errors&&Array.isArray(a.data.errors)?s.value=a.data.errors.join(", "):s.value=((r=a.data)==null?void 0:r.message)||"OTP verification failed. Please try again."}catch(l){if(console.error("OTP verification error:",l),l.response){const g=l.response.status,a=l.response.data;g===422?a.errors&&Array.isArray(a.errors)?s.value=a.errors.join(", "):s.value="Invalid OTP or mobile number.":g===401?s.value="Invalid OTP or mobile number.":s.value=a.message||"An error occurred during OTP verification."}else l.request?s.value="Network error. Please check your connection.":s.value="An unexpected error occurred."}finally{b.value=!1}},R=async()=>{var o;h.value=!0,s.value="";try{const e=p.userType==="garage"?"/provider/resend-otp":"/resend-otp",n={country_code:m.value,mobile:c.value};console.log("Resending OTP with data:",n);const r=await P.post(e,n);console.log("Resend OTP response:",r.data),r.data&&r.data.success?(D(),i.value=["","","",""],_(()=>{f.value[0].focus()})):s.value=((o=r.data)==null?void 0:o.message)||"Failed to resend OTP. Please try again."}catch(e){if(console.error("Resend OTP error:",e),e.response){const n=e.response.data;s.value=n.message||"An error occurred while resending OTP."}else e.request?s.value="Network error. Please check your connection.":s.value="An unexpected error occurred."}finally{h.value=!1}},z=()=>{O.push({path:`/signup/mobile/${p.userType}`,query:{countryCode:m.value,mobile:c.value}})},D=()=>{countdownInterval&&clearInterval(countdownInterval),d.value=60,countdownInterval=setInterval(()=>{d.value--,d.value<=0&&(clearInterval(countdownInterval),countdownInterval=null)},1e3)};return B(()=>{_(()=>{f.value[0].focus()})}),(o,e)=>(y(),$(Z,null,{default:E(()=>[t("div",J,[t("div",Y,[e[0]||(e[0]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-4"},"Enter Verification Code",-1)),t("p",Q," We've sent a 4-digit verification code to "+v(m.value)+" "+v(c.value),1)]),s.value?(y(),T("div",X,[t("div",ee,[e[2]||(e[2]=t("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("div",null,[e[1]||(e[1]=t("p",{class:"font-medium"},"Verification Failed",-1)),t("p",te,v(s.value),1)])])])):L("",!0),x.value?(y(),T("div",se,[t("div",ae,[e[4]||(e[4]=t("svg",{class:"h-5 w-5 text-green-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("div",null,[e[3]||(e[3]=t("p",{class:"font-medium"},"Success",-1)),t("p",oe,v(x.value),1)])])])):L("",!0),t("form",{onSubmit:H(q,["prevent"]),class:"space-y-6"},[t("div",re,[(y(!0),T(U,null,j(i.value,(n,r)=>K((y(),T("input",{key:r,"onUpdate:modelValue":l=>i.value[r]=l,type:"text",maxlength:"1",class:W(["w-12 h-12 text-center text-xl font-semibold border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",{"border-red-500":s.value}]),onInput:l=>S(r,l),onKeydown:[V(l=>I(r),["delete"]),V(l=>I(r),["backspace"])],ref_for:!0,ref_key:"otpInputs",ref:f},null,42,ne)),[[G,i.value[r]]])),128))]),t("button",{type:"submit",disabled:b.value||i.value.some(n=>!n),class:"w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white font-semibold py-3 px-4 rounded-lg transition-colors"},v(b.value?"Verifying...":"Verify"),9,le)],32),t("div",ie,[t("p",ue,[e[5]||(e[5]=A(" Didn't receive the code? ",-1)),t("button",{onClick:R,disabled:h.value||d.value>0,class:"text-red-500 hover:text-red-600 font-medium disabled:text-gray-400"},v(h.value?"Sending...":d.value>0?`Resend in ${d.value}s`:"Resend Code"),9,de)])]),t("div",{class:"mt-4 text-center"},[t("p",{class:"text-gray-600"},[e[6]||(e[6]=A(" Wrong number? ",-1)),t("button",{onClick:z,class:"text-red-500 hover:text-red-600 font-medium"}," Change number ")])])])]),_:1}))}};export{pe as default};
