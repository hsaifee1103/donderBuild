import{r as d,k as p}from"./app-CWmiax_p.js";const t={google:{clientId:"172913748045-h1vdff45t73n4ovjn0m73nja9043jdvn.apps.googleusercontent.com",scope:"email profile"},facebook:{appId:"1231173615524024",version:"v18.0"},apple:{clientId:"web.donderstorm.signin",redirectUri:window.location.origin+"/auth/apple/callback"}};function I(){const l=d(!1),s=d(null),u=()=>new Promise((o,n)=>{var a;if((a=window.google)!=null&&a.accounts){o();return}const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=o,e.onerror=n,document.head.appendChild(e)}),m=()=>new Promise((o,n)=>{if(window.FB){o();return}window.fbAsyncInit=function(){window.FB.init({appId:t.facebook.appId,cookie:!0,xfbml:!0,version:t.facebook.version}),o()};const e=document.createElement("script");e.src="https://connect.facebook.net/en_US/sdk.js",e.async=!0,e.defer=!0,e.crossOrigin="anonymous",e.onerror=n,document.head.appendChild(e)}),g=()=>new Promise((o,n)=>{if(window.AppleID){o();return}const e=document.createElement("script");e.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",e.async=!0,e.defer=!0,e.onload=o,e.onerror=n,document.head.appendChild(e)}),w=async()=>{try{return t.google.clientId,await u(),new Promise((o,n)=>{window.google.accounts.id.initialize({client_id:t.google.clientId,callback:e=>{const a=JSON.parse(atob(e.credential.split(".")[1]));o({id:a.sub,email:a.email,firstName:a.given_name,lastName:a.family_name,picture:a.picture,provider:"google"})}}),window.google.accounts.id.prompt(e=>{(e.isNotDisplayed()||e.isSkippedMoment())&&window.google.accounts.oauth2.initTokenClient({client_id:t.google.clientId,scope:t.google.scope,callback:async i=>{try{const c=await(await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${i.access_token}`}})).json();o({id:c.sub,email:c.email,firstName:c.given_name,lastName:c.family_name,picture:c.picture,provider:"google"})}catch(r){n(r)}},error_callback:i=>{n(new Error(i.message||"Google sign in failed"))}}).requestAccessToken()})})}catch(o){throw s.value=o.message,o}},h=async()=>{try{return t.facebook.appId,await m(),new Promise((o,n)=>{window.FB.login(e=>{e.authResponse?window.FB.api("/me",{fields:"id,name,first_name,last_name,email,picture"},a=>{var i,r;o({id:a.id,email:a.email,firstName:a.first_name,lastName:a.last_name,picture:(r=(i=a.picture)==null?void 0:i.data)==null?void 0:r.url,provider:"facebook"})}):n(new Error("Facebook login cancelled"))},{scope:"public_profile,email"})})}catch(o){throw s.value=o.message,o}},f=async()=>{try{return t.apple.clientId,await g(),new Promise((o,n)=>{window.AppleID.auth.init({clientId:t.apple.clientId,scope:"name email",redirectURI:t.apple.redirectUri,usePopup:!0}),window.AppleID.auth.signIn().then(e=>{var r,c;const{authorization:a,user:i}=e;o({id:a.id_token,email:i==null?void 0:i.email,firstName:(r=i==null?void 0:i.name)==null?void 0:r.firstName,lastName:(c=i==null?void 0:i.name)==null?void 0:c.lastName,provider:"apple",idToken:a.id_token})}).catch(e=>{n(new Error(e.error||"Apple sign in failed"))})})}catch(o){throw s.value=o.message,o}};return{isLoading:l,error:s,signInWithProvider:async o=>{l.value=!0,s.value=null;try{let n;switch(o){case"google":n=await w();break;case"facebook":n=await h();break;case"apple":n=await f();break;default:throw new Error(`Unsupported provider: ${o}`)}return n}catch(n){throw s.value=n.message,n}finally{l.value=!1}},checkSocialLogin:async o=>{var n,e;try{return(await p.post("/checkSocialLogin",{social_type:o.provider,social_id:o.id,fcm_token:"web_fcm_token"})).data}catch(a){throw new Error(((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to check social login")}},linkSocialAccount:async(o,n)=>{var e,a;try{return(await p.post("/linkSocialLogin",{user_id:o,provider:n.provider,social_id:n.id,social_type:n.provider,email:n.email,first_name:n.firstName,last_name:n.lastName})).data}catch(i){throw new Error(((a=(e=i.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to link social account")}},unlinkSocialAccount:async(o,n)=>{var e,a;try{return(await p.post("/unlinkSocialLogin",{user_id:o,provider:n})).data}catch(i){throw new Error(((a=(e=i.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to unlink social account")}}}}export{I as u};
