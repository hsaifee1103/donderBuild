import{r as c,d as N,b as K,c as W,o as n,w as Q,y as X,k as y,u as Z,a as t,f as i,g as h,n as g,t as x,i as j,v as U,I as z}from"./app-CeYD0-mp.js";import{P as ee}from"./ProviderDashboardLayout-_RL2-QAZ.js";/* empty css                                                                        */import"./NotificationDropdown-CFIqk1aN.js";import"./x-jDAcizyc.js";const te={class:"max-w-7xl mx-auto"},ae={class:"bg-white rounded-lg overflow-hidden"},se={class:"px-6 py-2"},oe={class:"flex items-start space-x-6",style:{"align-items":"center"}},re={class:"relative mb-4"},le=["src","alt","userDataJson"],ne={class:"p-6"},ie={key:0,class:"mb-6 p-4 bg-green-50 text-green-700 rounded-lg"},de={key:1,class:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg"},ue={class:"flex items-start"},ce={class:"space-y-0 shadow border rounded-lg border-gray-200"},me={class:"p-4 border-b border-gray-200"},pe={class:"p-4 border-b border-gray-200"},ge={class:"p-4 border-b border-gray-200"},ve={class:"flex justify-between items-center"},fe={class:"text-gray-900"},ye={class:"p-4"},he={class:"flex justify-between items-center"},xe={class:"text-gray-900"},_e={class:"mt-8"},we={class:"p-4 border rounded-lg border-gray-200 bg-gray-50 flex justify-between items-center"},be={class:"text-sm text-gray-500"},ke={key:0},Se={key:1},Ce={key:2},Ie={key:0,class:"flex items-center gap-2 text-gray-500"},De={key:1,class:"flex items-center gap-3"},ze=["disabled"],Ae={key:2,class:"flex items-center gap-3"},Me=["disabled"],Pe={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Be=["disabled"],Le={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ne={class:"mt-8 flex justify-between"},je=["disabled"],Ue={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-red-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ee={key:1,class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fe=["disabled"],Oe={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ve={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},He={class:"bg-white rounded-lg p-6 max-w-md w-full"},Je={class:"flex justify-end space-x-3"},Te=["disabled"],Ye="https://static.vecteezy.com/system/resources/previews/036/594/092/non_2x/man-empty-avatar-photo-placeholder-for-social-networks-resumes-forums-and-dating-sites-male-and-female-no-photo-images-for-unfilled-user-profile-free-vector.jpg",Qe={__name:"Profile",setup(Re){const b=Z(),A=c(null),l=c({first_name:"",last_name:"",email:"",phone:"",image_url:"",country_code:"+44",id:null,stripe_account_id:null}),d=c({first_name:"",last_name:"",phone:"",email:""}),_=c(!1),r=c(""),p=c(!1),v=c(!1),S=c(!1),k=c(!1),M=c({name:"United Kingdom",dial_code:"+44",code:"GB",flag:"gb"}),u=c("loading"),C=c(!1),E=N(()=>`${l.value.first_name} ${l.value.last_name}`),P=N(()=>d.value.first_name.trim()!==""&&d.value.last_name.trim()!==""),F=async()=>{try{await X();const a=localStorage.getItem("userData");if(a)try{const e=JSON.parse(a);if(console.log("Loaded user data from localStorage:",a),l.value={first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.mobile||"",image_url:(e==null?void 0:e.image_url)||"",country_code:e.country_code||"+44",id:e.id||null,stripe_account_id:e.stripe_account_id||null},d.value={first_name:e.first_name||"",last_name:e.last_name||"",phone:e.mobile||"",email:e.email||""},l.value.stripe_account_id?(u.value="loading",D()):u.value="not_connected",e.country_code){const s=q.find(o=>o.dial_code===e.country_code);s&&(M.value=s)}e.id&&O(e.id)}catch(e){console.error("Error parsing user data:",e)}}catch(a){console.error("Error loading user data:",a)}},O=async a=>{try{const e=await y.post("/provider/profile",{provider_id:a});if(e.data&&e.data.success&&e.data.data){const s=e.data.data;l.value={...l.value,stripe_account_id:s.stripe_account_id||null};const w={...JSON.parse(localStorage.getItem("userData")||"{}"),stripe_account_id:s.stripe_account_id};localStorage.setItem("userData",JSON.stringify(w)),l.value.stripe_account_id?D():u.value="not_connected"}}catch(e){console.error("Failed to fetch fresh profile data:",e)}},B=()=>{S.value=!0},V=async()=>{if(!P.value){r.value="First name and last name are required";return}p.value=!0,r.value="";try{const a={id:l.value.id,firstname:d.value.first_name,lastname:d.value.last_name};console.log("Sending update data:",a);const e=await y.post("/updateProfile",a);if(e.data&&e.data.success){l.value.first_name=d.value.first_name,l.value.last_name=d.value.last_name;const s=JSON.parse(localStorage.getItem("userData")||"{}");s.first_name=d.value.first_name,s.last_name=d.value.last_name,localStorage.setItem("userData",JSON.stringify(s)),z({type:"success",title:"Profile updated successfully",message:"Your profile has been updated successfully."}),_.value=!0,setTimeout(()=>{_.value=!1},3e3),S.value=!1}else e.data.errors&&Array.isArray(e.data.errors)&&e.data.errors.length>0?r.value=e.data.errors[0]:e.data.message?r.value=e.data.message:r.value="Failed to update profile. Please try again."}catch(a){if(console.error("Error updating profile:",a),a.response&&a.response.data){const e=a.response.data;e.errors&&Array.isArray(e.errors)&&e.errors.length>0?r.value=e.errors[0]:e.message?r.value=e.message:r.value="An error occurred while updating your profile. Please try again."}else r.value="An error occurred while updating your profile. Please try again."}finally{p.value=!1}},H=()=>{A.value.click()},J=async a=>{const e=a.target.files[0];if(e){if(!e.type.startsWith("image/")){r.value="Please select an image file";return}if(e.size>2*1024*1024){r.value="Image size must be less than 2MB";return}p.value=!0,r.value="";try{const s=new FormData;s.append("image",e),s.append("provider_id",l.value.id);const o=await y.post("/updateProfileImg",s,{headers:{"Content-Type":"multipart/form-data"}});if(o.data&&o.data.success){if(o.data.data&&o.data.data.image_url){l.value.image_url=o.data.data.image_url;const w=JSON.parse(localStorage.getItem("userData")||"{}");w.image=w.image||{},w.image.image_url=o.data.data.image_url,localStorage.setItem("userData",JSON.stringify(o.data.data)),_.value=!0,setTimeout(()=>{_.value=!1},3e3)}}else o.data.errors&&Array.isArray(o.data.errors)&&o.data.errors.length>0?r.value=o.data.errors[0]:o.data.message?r.value=o.data.message:r.value="Failed to upload image. Please try again."}catch(s){if(console.error("Error uploading image:",s),s.response&&s.response.data){const o=s.response.data;o.errors&&Array.isArray(o.errors)&&o.errors.length>0?r.value=o.errors[0]:o.message?r.value=o.message:r.value="An error occurred while uploading your image. Please try again."}else r.value="An error occurred while uploading your image. Please try again."}finally{p.value=!1}}},T=()=>{b.push("/provider/update-phone")},Y=()=>{b.push("/provider/update-email")},R=()=>{k.value=!0},G=async()=>{v.value=!0;try{await y.post("/provider/logout"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),b.push("/login")}catch(a){console.error("Error during logout:",a),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),b.push("/login")}finally{v.value=!1,k.value=!1}},m=c(!1),I=async()=>{var a,e;m.value=!0;try{const s=await y.post("/generateOnboardingLink",{provider_id:l.value.id});s.data&&s.data.success&&s.data.data&&s.data.data.url&&(window.open(s.data.data.url,"_blank"),z({type:"success",message:"Opening Stripe onboarding in new tab..."})),$()}catch(s){console.error("Stripe Connect Error:",s),z({type:"error",message:((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to connect with Stripe."}),m.value=!1}};let f=null;const $=()=>{f&&clearInterval(f);let a=0;f=setInterval(async()=>{if(a++,a>100){L(),m.value=!1;return}await D(),(u.value==="connected"||u.value==="not_connected")&&(L(),m.value=!1)},3e3)},L=()=>{f&&(clearInterval(f),f=null)},D=async()=>{if(l.value.stripe_account_id){C.value=!0;try{const a=await y.post("/checkOnboardingStatus",{stripe_account_id:l.value.stripe_account_id});a.data&&(a.data.status==="completed"||a.data.charges_enabled)?u.value="connected":a.data&&a.data.status==="not_connected"?u.value="not_connected":u.value="incomplete"}catch(a){console.error("Error checking Stripe status:",a),u.value="incomplete"}finally{C.value=!1}}},q=[{name:"United Kingdom",dial_code:"+44",code:"GB",flag:"gb"},{name:"United States",dial_code:"+1",code:"US",flag:"us"},{name:"India",dial_code:"+91",code:"IN",flag:"in"},{name:"Germany",dial_code:"+49",code:"DE",flag:"de"},{name:"France",dial_code:"+33",code:"FR",flag:"fr"},{name:"Australia",dial_code:"+61",code:"AU",flag:"au"}];return K(()=>{F()}),(a,e)=>(n(),W(ee,null,{default:Q(()=>[t("div",te,[e[26]||(e[26]=t("div",{class:"mt-5"},[t("h1",{class:"text-2xl px-6 font-bold text-gray-900"},"Personal Info")],-1)),t("div",ae,[t("div",se,[t("div",oe,[t("div",re,[t("img",{src:l.value.image_url||Ye,alt:E.value,class:"w-24 h-24 rounded-full object-cover border-4 border-white shadow-md",userDataJson:JSON.stringify(l.value)},null,8,le),t("input",{type:"file",ref_key:"fileInput",ref:A,onChange:J,class:"hidden",accept:"image/*"},null,544)]),t("button",{onClick:H,class:"text-red-500 hover:text-red-600 bg-red-100 hover:bg-red-200 rounded-md px-4 py-2 font-medium flex items-center"},[...e[3]||(e[3]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),g(" Change profile picture ",-1)])])])]),t("div",ne,[e[25]||(e[25]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-6"},"Personal Information",-1)),_.value?(n(),i("div",ie,[...e[4]||(e[4]=[t("div",{class:"flex items-start"},[t("svg",{class:"h-5 w-5 text-green-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),t("p",null,"Your profile has been updated successfully!")],-1)])])):h("",!0),r.value?(n(),i("div",de,[t("div",ue,[e[5]||(e[5]=t("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("p",null,x(r.value),1)])])):h("",!0),t("div",ce,[t("div",me,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-500 mb-1"},"First name",-1)),j(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.first_name=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:B},null,544),[[U,d.value.first_name]])]),t("div",pe,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Last name",-1)),j(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.last_name=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:B},null,544),[[U,d.value.last_name]])]),t("div",ge,[t("div",ve,[t("div",null,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Phone",-1)),t("p",fe,x(M.value.dial_code)+" "+x(l.value.phone),1)]),t("button",{onClick:T,class:"text-red-500 hover:text-red-600 font-medium flex items-center"},[...e[9]||(e[9]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),g(" Edit ",-1)])])])]),t("div",ye,[t("div",he,[t("div",null,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Email",-1)),t("p",xe,x(l.value.email),1)]),t("button",{onClick:Y,class:"text-red-500 hover:text-red-600 font-medium flex items-center"},[...e[11]||(e[11]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),g(" Edit ",-1)])])])])]),t("div",_e,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Payout Settings",-1)),t("div",we,[t("div",null,[e[12]||(e[12]=t("p",{class:"font-medium text-gray-900"},"Stripe Connect",-1)),t("p",be,[u.value==="connected"?(n(),i("span",ke,"Your Stripe account is connected and ready to receive payouts.")):u.value==="incomplete"?(n(),i("span",Se,"Your Stripe account setup is incomplete.")):(n(),i("span",Ce,"Connect your Stripe account to receive payouts directly."))])]),C.value?(n(),i("div",Ie,[...e[13]||(e[13]=[t("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("span",{class:"text-sm"},"Checking status...",-1)])])):u.value==="connected"?(n(),i("div",De,[e[14]||(e[14]=t("div",{class:"flex items-center gap-2"},[t("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("span",{class:"text-sm font-medium text-green-600"},"Connected")],-1)),t("button",{onClick:I,disabled:m.value,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md font-medium text-sm transition-colors"}," Reconnect ",8,ze)])):u.value==="incomplete"?(n(),i("div",Ae,[e[17]||(e[17]=t("div",{class:"flex items-center gap-2"},[t("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),t("span",{class:"text-sm font-medium text-yellow-600"},"Action Required")],-1)),t("button",{onClick:I,disabled:m.value,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium flex items-center transition-colors"},[m.value?(n(),i("svg",Pe,[...e[15]||(e[15]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):h("",!0),e[16]||(e[16]=g(" Complete Setup ",-1))],8,Me)])):(n(),i("button",{key:3,onClick:I,disabled:m.value,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md font-medium flex items-center transition-colors"},[m.value?(n(),i("svg",Le,[...e[18]||(e[18]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):h("",!0),e[19]||(e[19]=g(" Connect with Stripe ",-1))],8,Be))])]),t("div",Ne,[t("button",{onClick:R,class:"px-4 py-2 text-red-500 hover:text-red-600 font-medium flex items-center",disabled:v.value},[v.value?(n(),i("svg",Ue,[...e[21]||(e[21]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),i("svg",Ee,[...e[22]||(e[22]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"},null,-1)])])),e[23]||(e[23]=g(" Logout ",-1))],8,je),t("button",{onClick:V,class:"px-6 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium flex items-center",disabled:p.value||!S.value||!P.value},[p.value?(n(),i("svg",Oe,[...e[24]||(e[24]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):h("",!0),g(" "+x(p.value?"Saving...":"Save"),1)],8,Fe)])])])]),k.value?(n(),i("div",Ve,[t("div",He,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Are you sure you want to logout?",-1)),e[28]||(e[28]=t("p",{class:"text-gray-600 mb-6"}," By logging out, you will not have access to your bookings and notifications. To gain access again, you must log back in. ",-1)),t("div",Je,[t("button",{onClick:e[2]||(e[2]=s=>k.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium"}," No, cancel "),t("button",{onClick:G,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium",disabled:v.value},x(v.value?"Logging out...":"Yes, logout"),9,Te)])])])):h("",!0)]),_:1}))}};export{Qe as default};
