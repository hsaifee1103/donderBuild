import{r as n,d as N,a as j,o as d,w as B,y as F,u as K,b as a,f as u,g as h,t as p,i as x,v as _,F as S,p as k,A as V,k as A}from"./app-Dc5tvvr1.js";import{P as T}from"./ProviderDashboardLayout-CxuYajoD.js";import"./NotificationDropdown-DMUdgZ-P.js";import"./x-C7--vmmO.js";const z={class:"max-w-7xl mx-auto"},R={class:"bg-white rounded-lg overflow-hidden mt-6"},J={class:"p-6"},$={key:0,class:"mb-6 p-4 bg-green-50 text-green-700 rounded-lg"},Y={class:"flex items-start"},q={key:1,class:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg"},G={class:"flex items-start"},H={key:2},Q={class:"mb-6"},W={class:"flex justify-end"},X=["disabled"],Z={key:3},ee={class:"mb-6"},re={class:"mb-4"},ae={class:"text-sm font-medium text-gray-700 mb-2"},te={class:"flex space-x-2"},se=["onUpdate:modelValue","onInput","onKeydown"],oe={class:"text-sm font-medium text-gray-700 mb-2"},le={class:"flex space-x-2"},ne=["onUpdate:modelValue","onInput","onKeydown"],ie={class:"flex justify-between"},de=["disabled"],ue=["disabled"],me={__name:"UpdateEmail",setup(ce){const O=K(),b=n(1),E=n(""),i=n(""),c=n(["","","",""]),v=n(["","","",""]),f=n(!1),w=n(""),t=n(""),g=n(!1),m=n(!1),y=n(!1),C=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),I=async()=>{try{await F();const r=localStorage.getItem("userData");if(r)try{const e=JSON.parse(r);E.value=e.email||""}catch(e){console.error("Error parsing user data:",e)}}catch(r){console.error("Error loading user data:",r)}},P=(r,e,o)=>{const s=o.target.value;if(!/^\d*$/.test(s)){o.target.value="";return}if(s&&e<3){const l=o.target.nextElementSibling;l&&l.focus()}},D=(r,e,o)=>{if(!o.target.value&&e>0){const s=o.target.previousElementSibling;s&&s.focus()}},U=async()=>{if(!C(i.value)){t.value="Please enter a valid email address";return}g.value=!0,t.value="";try{const r=await A.post("/send-verification-otp",{type:"provider",entity:"email",value:i.value});r.data&&r.data.success?(b.value=2,c.value=["","","",""],v.value=["","","",""]):r.data.errors&&Array.isArray(r.data.errors)&&r.data.errors.length>0?t.value=r.data.errors[0]:r.data.message?t.value=r.data.message:t.value="Failed to send verification code. Please try again."}catch(r){if(console.error("Error sending verification code:",r),r.response&&r.response.data){const e=r.response.data;e.errors&&Array.isArray(e.errors)&&e.errors.length>0?t.value=e.errors[0]:e.message?t.value=e.message:t.value="An error occurred while sending verification code. Please try again."}else t.value="An error occurred while sending verification code. Please try again."}finally{g.value=!1}},M=async()=>{m.value=!0,t.value="";try{const r=await A.post("/send-verification-otp",{type:"provider",entity:"email",value:i.value});r.data&&r.data.success?(c.value=["","","",""],v.value=["","","",""],w.value="Verification code has been resent.",f.value=!0,setTimeout(()=>{f.value=!1},3e3)):r.data.errors&&Array.isArray(r.data.errors)&&r.data.errors.length>0?t.value=r.data.errors[0]:r.data.message?t.value=r.data.message:t.value="Failed to resend verification code. Please try again."}catch(r){if(console.error("Error resending verification code:",r),r.response&&r.response.data){const e=r.response.data;e.errors&&Array.isArray(e.errors)&&e.errors.length>0?t.value=e.errors[0]:e.message?t.value=e.message:t.value="An error occurred while resending verification code. Please try again."}else t.value="An error occurred while resending verification code. Please try again."}finally{m.value=!1}},L=async()=>{const r=c.value.join(""),e=v.value.join("");if(r.length!==4||e.length!==4){t.value="Please enter complete verification codes";return}y.value=!0,t.value="";try{const o=await A.post("/verify-and-update",{type:"provider",entity:"email",value:i.value});if(o.data&&o.data.success){const s=JSON.parse(localStorage.getItem("userData")||"{}");s.email=i.value,localStorage.setItem("userData",JSON.stringify(s)),w.value="Your email address has been updated successfully!",f.value=!0,setTimeout(()=>{O.push("/provider/profile")},2e3)}else o.data.errors&&Array.isArray(o.data.errors)&&o.data.errors.length>0?t.value=o.data.errors[0]:o.data.message?t.value=o.data.message:t.value="Failed to verify and update email address. Please try again."}catch(o){if(console.error("Error verifying and updating email:",o),o.response&&o.response.data){const s=o.response.data;s.errors&&Array.isArray(s.errors)&&s.errors.length>0?t.value=s.errors[0]:s.message?t.value=s.message:t.value="An error occurred while verifying and updating your email address. Please try again."}else t.value="An error occurred while verifying and updating your email address. Please try again."}finally{y.value=!1}};return N(()=>{I()}),(r,e)=>(d(),j(T,null,{default:B(()=>[a("div",z,[e[7]||(e[7]=a("div",{class:"mt-5"},[a("h1",{class:"text-2xl px-6 font-bold text-gray-900"},"Update Email Address")],-1)),a("div",R,[a("div",J,[f.value?(d(),u("div",$,[a("div",Y,[e[1]||(e[1]=a("svg",{class:"h-5 w-5 text-green-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),a("p",null,p(w.value),1)])])):h("",!0),t.value?(d(),u("div",q,[a("div",G,[e[2]||(e[2]=a("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),a("p",null,p(t.value),1)])])):h("",!0),b.value===1?(d(),u("div",H,[e[3]||(e[3]=a("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Enter New Email Address",-1)),e[4]||(e[4]=a("p",{class:"text-gray-600 mb-6"},"For security purposes, we need to verify your new email address. Kindly enter it below to proceed with the confirmation process.",-1)),a("div",Q,[x(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Enter your new email here"},null,512),[[_,i.value]])]),a("div",W,[a("button",{onClick:U,class:"px-6 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium",disabled:g.value||!C(i.value)},p(g.value?"Sending...":"Continue"),9,X)])])):h("",!0),b.value===2?(d(),u("div",Z,[e[5]||(e[5]=a("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Email Verification",-1)),e[6]||(e[6]=a("p",{class:"text-gray-600 mb-6"}," To ensure the security of your account, we've sent a 4-digit verification code to both your current and new email addresses. Please enter the codes below to complete the verification process. ",-1)),a("div",ee,[a("div",re,[a("p",ae,"Current Email OTP: "+p(E.value),1),a("div",te,[(d(!0),u(S,null,k(c.value,(o,s)=>x((d(),u("input",{key:s,"onUpdate:modelValue":l=>c.value[s]=l,type:"text",maxlength:"1",class:"w-12 h-12 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:l=>P("current",s,l),onKeydown:V(l=>D("current",s,l),["delete"])},null,40,se)),[[_,c.value[s]]])),128))])]),a("div",null,[a("p",oe,"New Email OTP: "+p(i.value),1),a("div",le,[(d(!0),u(S,null,k(v.value,(o,s)=>x((d(),u("input",{key:s,"onUpdate:modelValue":l=>v.value[s]=l,type:"text",maxlength:"1",class:"w-12 h-12 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:l=>P("new",s,l),onKeydown:V(l=>D("new",s,l),["delete"])},null,40,ne)),[[_,v.value[s]]])),128))])])]),a("div",ie,[a("button",{onClick:M,class:"px-4 py-2 text-red-500 hover:text-red-600 font-medium",disabled:m.value},p(m.value?"Resending...":"Resend Code"),9,de),a("button",{onClick:L,class:"px-6 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium",disabled:y.value||c.value.join("").length!==4||v.value.join("").length!==4},p(y.value?"Verifying...":"Continue"),9,ue)])])):h("",!0)])])])]),_:1}))}};export{me as default};
