import{l as I,r as u,d as O,b as T,c as U,o as l,w as x,k as m,u as M,j as N,a as e,f as n,g as _,F as R,p as F,G as $,t as k,I as f}from"./app-BYumhLZY.js";import{P as z}from"./ProviderDashboardLayout-DPFjNEtt.js";import{S as K}from"./SetupLayout-D-Alj5Z2.js";import"./NotificationDropdown-CxOzbOLU.js";import"./x-DVwV6MwH.js";const A={class:"w-full p-6 overflow-y-auto"},J={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},V={key:0,class:"flex justify-center items-center h-64"},q={key:1,class:"space-y-6"},G={class:""},Y={class:"grid grid-cols-2 gap-4 max-w-md"},H=["src","alt"],W=["onClick"],Q={key:0,class:"absolute inset-0 bg-black/45 flex items-center justify-center"},X={class:"relative w-16 h-16"},Z={class:"absolute inset-[4px] bg-black/60 rounded-full flex items-center justify-center"},ee={class:"text-white text-sm font-medium"},te={class:"fixed bottom-4 left-1/2 lg:static lg:mb-6 z-10 w-full lg:w-auto py-6"},oe=["disabled"],se={__name:"Portfolio",setup(re){const S=M(),b=u(!0),p=u(!1),c=u([]),a=u([]),y=u(null),v=O(()=>[...c.value.map(t=>({id:t.id,url:t.img,alt:`Portfolio image ${t.id}`,progress:null})),...a.value].slice(0,4)),h=async()=>{var t;try{const o=localStorage.getItem("userData");if(!o)return;const s=JSON.parse(o),r=await m.get("/get-business-portfolio",{provider_id:s.id});(t=r.data)!=null&&t.success&&(c.value=r.data.data||[])}catch(o){console.error("Error fetching portfolio:",o)}finally{b.value=!1}};function P(){var t;(t=y.value)==null||t.click()}function j(t){const o=Array.from(t.target.files||[]);if(v.value.length+o.length>4){f({type:"error",title:"Limit Reached",message:"You can only upload up to 4 images.",confirmButtonText:"OK"});return}o.forEach(s=>{if(s.size>2*1024*1024){f({type:"error",title:"File Too Large",message:`${s.name} exceeds the 2MB size limit.`,confirmButtonText:"OK"});return}const r=URL.createObjectURL(s);a.value.push({id:`${s.name}-${Date.now()}`,url:r,alt:s.name,progress:0,file:s});const d=a.value.length-1;let i=0;const g=setInterval(()=>{i+=10,a.value[d].progress=Math.min(i,100),i>=100&&(clearInterval(g),setTimeout(()=>{a.value[d].progress=null},300))},200)}),t.target.value=""}function B(t){const s=[...c.value.map(r=>({...r,isExisting:!0})),...a.value][t];if(s.isExisting)C(s.id);else{const r=a.value.splice(t-c.value.length,1)[0];r&&r.url.startsWith("blob:")&&URL.revokeObjectURL(r.url)}}const C=async t=>{try{await m.post("/deletePortfolio",{portfolio_id:t,_method:"DELETE"}),await h()}catch(o){console.error("Error deleting portfolio image:",o)}};function L(t){return{background:`conic-gradient(var(--red-500) ${Math.max(0,Math.min(100,t??0))*3.6}deg, rgba(255,255,255,0.2) 0)`,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.15))"}}const D=async()=>{var t,o,s;if(a.value.length===0&&c.value.length===0){f({type:"warning",title:"No Images",message:"Please upload at least one image to continue.",confirmButtonText:"OK"});return}p.value=!0;try{if(a.value.length>0){const g=new FormData;a.value.forEach(E=>{g.append("img[]",E.file)});const w=await m.post("/portfolio",g,{headers:{"Content-Type":"multipart/form-data"}});if((t=w.data)!=null&&t.success)f({type:"success",title:"Portfolio Updated Successfully",message:"Your work demos have been uploaded.",confirmButtonText:"Great!"}),await h(),a.value=[];else throw new Error(((o=w.data)==null?void 0:o.message)||"Upload failed")}const r=localStorage.getItem("userData"),d=JSON.parse(r),i=await m.post("/garage",{provider_id:d.id});(s=i.data)!=null&&s.success&&localStorage.setItem("userData",JSON.stringify(i.data.data)),S.push("/provider/setup/employees")}catch(r){console.error("Upload error:",r),f({type:"error",title:"Upload Failed",message:r.message||"An error occurred while uploading images.",confirmButtonText:"OK"})}finally{p.value=!1}};return T(()=>{h()}),(t,o)=>(l(),U(z,null,{default:x(()=>[N(K,null,{default:x(()=>[e("div",A,[e("div",J,[o[3]||(o[3]=e("div",{class:"mb-8"},[e("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Upload demos of your work"),e("p",{class:"text-sm text-gray-600"},"Seeing is believing show off your skills and win customers trust.")],-1)),b.value?(l(),n("div",V,[...o[0]||(o[0]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"},null,-1)])])):(l(),n("div",q,[e("div",G,[e("div",Y,[(l(!0),n(R,null,F(v.value,(s,r)=>(l(),n("div",{key:s.id,class:"relative group aspect-square rounded-xl overflow-hidden border-2 border-gray-200"},[e("img",{src:s.url,alt:s.alt||"Portfolio image",class:"w-full h-full object-cover"},null,8,H),e("button",{type:"button",class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/60 hover:bg-black text-white rounded-full w-6 h-6 flex items-center justify-center","aria-label":"Remove photo",onClick:d=>B(r)},[...o[1]||(o[1]=[e("svg",{class:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,W),s.progress!==null?(l(),n("div",Q,[e("div",X,[e("div",{class:"absolute inset-0 rounded-full",style:$(L(s.progress)),"aria-hidden":"true"},null,4),e("div",Z,[e("span",ee,k(s.progress)+"%",1)])])])):_("",!0)]))),128)),v.value.length<4?(l(),n("button",{key:0,class:"relative aspect-square rounded-xl border-2 border-dashed border-red-300 text-red-500 hover:bg-red-50/40 transition-colors",onClick:P,type:"button","aria-label":"Add photos"},[o[2]||(o[2]=e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"w-9 h-9 rounded-full border border-red-300 flex items-center justify-center"},[e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})])])])],-1)),e("input",{ref_key:"fileInput",ref:y,class:"sr-only",type:"file",accept:"image/*",onChange:j},null,544)])):_("",!0)])])])),e("div",te,[e("button",{onClick:D,disabled:p.value,class:"w-full lg:w-auto bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-medium py-3 px-8 rounded-md transition-colors shadow-lg"},k(p.value?"Saving...":"Save & Continue"),9,oe)])])])]),_:1})]),_:1}))}},de=I(se,[["__scopeId","data-v-29d6712d"]]);export{de as default};
