import{l as R,r as o,f as u,o as r,a as s,i as y,v as _,h as M,b as z,k as S,c as P,w as V,u as q,j as A,g as b,t as g,q as C,n as B,I}from"./app-DJPj3-n2.js";import{P as j}from"./ProviderDashboardLayout-Dx-s-8A8.js";import{S as J}from"./SetupLayout-D1O_Zc-Y.js";import"./NotificationDropdown-DQWgBRpK.js";import"./x-BthwGwRq.js";import"./BackIcon-lq4datRr.js";import"./IconDocument-CRWGE1aM.js";const O={class:"modal-box"},W={class:"picker-container"},Y={__name:"DatePickerModal",emits:["close","select"],setup(E,{emit:N}){const c=N,d=o(new Date().toISOString().substring(0,10)),p=()=>{c("select",d.value)},v=()=>{c("close")};return(f,i)=>(r(),u("div",{class:"modal-overlay",onClick:M(v,["self"])},[s("div",O,[s("div",{class:"modal-header"},[i[1]||(i[1]=s("div",{class:"title"},"Select Established In",-1)),s("button",{class:"done-btn",onClick:p}," Done ")]),s("div",W,[y(s("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=m=>d.value=m),class:"date-input"},null,512),[[_,d.value]])])])]))}},H=R(Y,[["__scopeId","data-v-f9d31941"]]),K={class:"content-box"},Q={class:"white-card"},X={class:"upload-section"},Z=["src"],ee={class:"form-group"},se={key:0,class:"error-message"},te={class:"form-group"},ae={key:0,class:"error-message"},le={class:"form-group"},ie={key:0,class:"error-message"},oe={class:"form-group"},ne={class:"vat-options"},re={key:0,class:"error-message"},ue={key:0,class:"form-group"},de={key:0,class:"error-message"},ve={class:"form-group"},ce=["disabled"],pe={key:0},me={key:1,class:"loading-spinner"},be={__name:"BusinessInfoScreen",setup(E){const N=q(),c=o("/placeholder-logo.png"),d=o(null),p=o(""),v=o(""),f=o(""),i=o(null),m=o(""),h=o(""),w=o(!1),k=o(!1),l=o({businessName:"",website:"",establishedIn:"",vatRegistered:"",vatNumber:""}),x=o(null),F=JSON.parse(localStorage.getItem("userData")||"{}"),U=()=>{var t;(t=x.value)==null||t.click()},T=t=>{var D;const e=(D=t.target.files)==null?void 0:D[0];if(!e)return;const a=["image/jpeg","image/png","image/jpg","image/gif","image/svg"],n=2*1024*1024;if(!a.includes(e.type)){l.value.businessName="Please upload a valid image file (JPEG, PNG, JPG, GIF, SVG)";return}if(e.size>n){l.value.businessName="Image size should not exceed 2MB";return}d.value=e,c.value=URL.createObjectURL(e),l.value.businessName=""},$=t=>{const e=new Date(t);f.value=e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),w.value=!1},G=()=>{let t=!0;return l.value={businessName:"",website:"",establishedIn:"",vatRegistered:"",vatNumber:""},p.value.trim()||(l.value.businessName="Business name is required",t=!1),f.value||(l.value.establishedIn="Established date is required",t=!1),i.value===null&&(l.value.vatRegistered="Please select if your business is VAT registered",t=!1),i.value===!0&&!m.value.trim()&&(l.value.vatNumber="VAT number is required when VAT registered",t=!1),v.value.trim()&&(/^(https?:\/\/)?(www\.)?[a-z0-9\-]+\.[a-z]{2,}(\S*)?$/i.test(v.value)||(l.value.website="Please enter a valid website URL",t=!1)),!d.value&&c.value==="/placeholder-logo.png"&&(l.value.businessName="Business logo is required",t=!1),t},L=async()=>{var t;if(G()){k.value=!0;try{const e=new FormData;e.append("business_name",p.value),e.append("business_website",v.value||""),e.append("established_in",f.value),e.append("vat_no",m.value||""),e.append("companyRegistrationNumber",h.value||""),d.value&&e.append("image",d.value);const a=await S.post("/add-business",e);a.data.success?(I({type:"success",title:"Business Created",message:"Your business information has been saved successfully."}),N.push("/provider/business-hub/location")):I({type:"error",title:"Failed",message:((t=a.data.errors)==null?void 0:t[0])||"Failed to create business."})}catch(e){I({type:"error",title:"Error",message:e.message||"Something went wrong."})}k.value=!1}};return z(async()=>{try{const t=F.id;if(!t){console.error("Provider ID not found");return}const e=await S.post("/provider/profile",{provider_id:t});if(e.data){const a=e.data.data;if(console.log("Fetched provider data:",a),a.businesses&&a.businesses.length>0){const n=a.businesses[0];console.log("Fetched business data:",n),p.value=n.business_name||"",v.value=n.business_website||"",f.value=n.established_in||"",i.value=!!n.vat_no,m.value=n.vat_no||"",h.value=n.companyRegistrationNumber||"",n.file_id&&(c.value=n.file_id)}}}catch(t){console.error("Error fetching business info:",t)}}),(t,e)=>(r(),P(j,null,{default:V(()=>[A(J,null,{default:V(()=>[s("div",K,[e[16]||(e[16]=s("h1",{class:"content-title"},"Business information",-1)),e[17]||(e[17]=s("p",{class:"content-subtitle"}," This is the business information that customers will see when browsing. Please fill in the correct information as your legal documents for verification. ",-1)),s("div",Q,[s("div",X,[s("img",{src:c.value,class:"upload-preview"},null,8,Z),s("button",{class:"upload-btn",onClick:U}," Upload Business Logo "),s("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/*",class:"hidden",onChange:T},null,544)]),s("div",ee,[e[8]||(e[8]=s("label",{class:"label"},"What's your business name? *",-1)),y(s("input",{type:"text",class:"input","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),placeholder:"Ex: my garage solution"},null,512),[[_,p.value]]),l.value.businessName?(r(),u("div",se,g(l.value.businessName),1)):b("",!0)]),s("div",te,[e[9]||(e[9]=s("label",{class:"label"},"What's your business website? (optional)",-1)),y(s("input",{type:"text",class:"input","onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),placeholder:"Ex: www.mybusiness.com"},null,512),[[_,v.value]]),l.value.website?(r(),u("div",ae,g(l.value.website),1)):b("",!0)]),s("div",le,[e[10]||(e[10]=s("label",{class:"label"},"Established In *",-1)),s("div",{class:"date-input",onClick:e[2]||(e[2]=a=>w.value=!0)},g(f.value||"Ex: 20 May 1996"),1),l.value.establishedIn?(r(),u("div",ie,g(l.value.establishedIn),1)):b("",!0)]),s("div",oe,[e[13]||(e[13]=s("label",{class:"label"},"Is your business VAT registered?",-1)),s("div",ne,[s("div",{class:C(["radio-option",{active:i.value===!0}]),onClick:e[3]||(e[3]=a=>i.value=!0)},[...e[11]||(e[11]=[s("div",{class:"radio-dot"},null,-1),B(" Yes ",-1)])],2),s("div",{class:C(["radio-option",{active:i.value===!1}]),onClick:e[4]||(e[4]=a=>i.value=!1)},[...e[12]||(e[12]=[s("div",{class:"radio-dot"},null,-1),B(" No ",-1)])],2)]),l.value.vatRegistered?(r(),u("div",re,g(l.value.vatRegistered),1)):b("",!0)]),i.value===!0?(r(),u("div",ue,[e[14]||(e[14]=s("label",{class:"label"},"VAT number*",-1)),y(s("input",{type:"text",class:"input",maxlength:"9",placeholder:"GB123456789","onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a)},null,512),[[_,m.value]]),l.value.vatNumber?(r(),u("div",de,g(l.value.vatNumber),1)):b("",!0)])):b("",!0),s("div",ve,[e[15]||(e[15]=s("label",{class:"label"},"Company registration number (optional)",-1)),y(s("input",{type:"text",class:"input",maxlength:"8",placeholder:"Enter company registration number","onUpdate:modelValue":e[6]||(e[6]=a=>h.value=a)},null,512),[[_,h.value]])]),s("button",{class:"save-btn",onClick:L,disabled:k.value},[k.value?(r(),u("span",me)):(r(),u("span",pe,"Continue"))],8,ce)])]),w.value?(r(),P(H,{key:0,onClose:e[7]||(e[7]=a=>w.value=!1),onSelect:$})):b("",!0)]),_:1})]),_:1}))}},Ne=R(be,[["__scopeId","data-v-0900fc62"]]);export{Ne as default};
