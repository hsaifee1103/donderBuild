import{l as V,r as l,b as Z,f as P,o as N,a,g as E,t as z,h as J,i as M,v as x,k as h}from"./app-U24E4X8J.js";const Y={class:"flex-1 flex flex-col lg:flex-row"},q={class:"flex-1 p-8 overflow-y-auto bg-white"},W={key:0,class:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg"},j={class:"flex items-center space-x-2"},Q={class:"font-medium"},$={class:"grid grid-cols-2 gap-6"},X={class:"grid grid-cols-2 gap-6"},ee=["disabled"],ae={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},oe={__name:"BusinessLocationForm",emits:["success"],setup(ne,{emit:U}){const T=U,I=l(!1),r=l(""),d=l(""),B=l(""),p=l(""),g=l(""),i=l(""),v=l(""),G=l(null),b=l(null),f=l(null),L=l(null),R=[{name:"Afghanistan",code:"AF"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Brazil",code:"BR"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Costa Rica",code:"CR"},{name:"Cote d'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Greece",code:"GR"},{name:"Grenada",code:"GD"},{name:"Guatemala",code:"GT"},{name:"Guinea",code:"GN"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Laos",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mexico",code:"MX"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montenegro",code:"ME"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"North Korea",code:"KP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestine",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Romania",code:"RO"},{name:"Russia",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia",code:"RS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Korea",code:"KR"},{name:"South Sudan",code:"SS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syria",code:"SY"},{name:"Taiwan",code:"TW"},{name:"Tanzania",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Togo",code:"TG"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}],K=()=>{if(window.google&&window.google.maps){_();return}const n=document.createElement("script");n.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgnny_BI3s86wp8bZIznJU1qkL1o7leDo&libraries=places",n.async=!0,n.defer=!0,n.onload=()=>{window.google&&window.google.maps?_():console.error("Google Maps API loaded but window.google.maps is undefined")},document.head.appendChild(n)};function _(){if(!window.google||!window.google.maps){console.error("Google Maps API not loaded");return}const n=document.getElementById("map");if(!n)return;const e=53.3809,o=-1.469;b.value=new window.google.maps.Map(n,{center:{lat:e,lng:o},zoom:13,mapTypeId:"roadmap",styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),f.value=new window.google.maps.Marker({position:{lat:e,lng:o},map:b.value,draggable:!0,title:"Your Business Location"}),f.value.addListener("dragend",()=>{const t=f.value.getPosition(),u=t.lat(),c=t.lng();new window.google.maps.Geocoder().geocode({location:{lat:u,lng:c}},(m,y)=>{y==="OK"&&m[0]&&D(m[0])})}),G.value&&(L.value=new window.google.maps.places.Autocomplete(G.value,{types:["establishment","geocode"]}),L.value.addListener("place_changed",()=>{const t=L.value.getPlace();if(!t.geometry){r.value="No details available for this location";return}D(t),t.geometry.viewport?b.value.fitBounds(t.geometry.viewport):(b.value.setCenter(t.geometry.location),b.value.setZoom(17)),f.value.setPosition(t.geometry.location)}))}function D(n){if(d.value="",B.value="",p.value="",g.value="",v.value="",i.value="",n.address_components)for(const e of n.address_components)switch(e.types[0]){case"street_number":{d.value=`${e.long_name} ${d.value}`;break}case"route":{d.value+=e.long_name;break}case"sublocality_level_1":case"sublocality":case"locality":{p.value=e.long_name;break}case"administrative_area_level_1":{g.value=e.long_name;break}case"country":{const t=e.short_name,u=R.find(c=>c.code===t);i.value=u?u.name:e.long_name;break}case"postal_code":{v.value=e.long_name;break}}!d.value&&n.formatted_address&&(d.value=n.formatted_address.split(",")[0])}const F=async()=>{var n,e,o;try{const t=localStorage.getItem("userData");if(!t)return;const u=JSON.parse(t),c=await h.post("/provider/profile",{provider_id:u.id});if((n=c.data)!=null&&n.success&&((o=(e=c.data.data)==null?void 0:e.business_location)==null?void 0:o.length)>0){const s=c.data.data.business_location[0];d.value=s.address_line_1||"",B.value=s.address_line_2||"",p.value=s.city||"",g.value=s.state||"",i.value=s.country||"",v.value=s.pass_code||"";const m=parseFloat(s.latitude)||53.3809,y=parseFloat(s.longitude)||-1.469;if(b.value&&f.value){const S={lat:m,lng:y};b.value.setCenter(S),f.value.setPosition(S)}}}catch(t){console.error("Error fetching provider data:",t)}},H=async()=>{var n,e,o,t,u,c;if(!d.value||!p.value||!g.value||!i.value||!v.value){r.value="Please fill in all required fields.";return}I.value=!0,r.value="";try{let s=53.3809,m=-1.469;if(f.value){const A=f.value.getPosition();s=A.lat(),m=A.lng()}const S={"United States":"US",Canada:"CA","United Kingdom":"GB",Australia:"AU",India:"IN"}[i.value]||i.value.toUpperCase().slice(0,2),O={address_line_1:d.value,address_line_2:B.value||null,city:p.value,state:g.value,country:i.value,country_code:S,pass_code:v.value,latitude:s,longitude:m},w=await h.post("/business_location",O);if((n=w.data)!=null&&n.success){const A=localStorage.getItem("userData"),k=JSON.parse(A),C=await h.post("/provider/profile",{provider_id:k.id});(e=C.data)!=null&&e.success&&localStorage.setItem("userData",JSON.stringify(C.data.data)),T("success",w)}else if((t=(o=w.data)==null?void 0:o.data)!=null&&t.business_location){console.warn("Stripe integration warning:",w.data.data.stripe_error);const A=localStorage.getItem("userData"),k=JSON.parse(A),C=await h.post("/provider/profile",{provider_id:k.id});(u=C.data)!=null&&u.success&&localStorage.setItem("userData",JSON.stringify(C.data.data)),T("success",w)}else r.value=((c=w.data)==null?void 0:c.message)||"Failed to save location."}catch(s){if(console.error("Submission error:",s),s.response){const m=s.response.status,y=s.response.data;if(m===422){const S=y.errors||[];r.value=S.join(", ")||"Invalid input data."}else m===500?r.value="Server error. Please try again later.":r.value=y.message||"An error occurred while saving business location."}else s.request?r.value="Network error. Please check your connection.":r.value="An unexpected error occurred."}finally{I.value=!1}};return Z(()=>{K(),F()}),(n,e)=>(N(),P("div",Y,[a("div",q,[e[16]||(e[16]=a("div",{class:"mb-8"},[a("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Set your business location"),a("p",{class:"text-sm text-gray-600"},"Add your business location so your clients can easily find you.")],-1)),r.value?(N(),P("div",W,[a("div",j,[e[6]||(e[6]=a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 5.636l-12.728 12.728m0-12.728l12.728 12.728"})],-1)),a("span",Q,z(r.value),1)])])):E("",!0),a("form",{onSubmit:J(H,["prevent"]),class:"space-y-6 mb-8"},[e[14]||(e[14]=a("div",null,[a("label",{class:"block text-sm font-semibold text-gray-900 mb-3"},"Business address")],-1)),a("div",null,[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Address line 1 *",-1)),M(a("input",{ref_key:"addressInput",ref:G,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),type:"text",placeholder:"5 St. Barnabas Rd, Highfield, Sheffield S2 4TH",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",required:""},null,512),[[x,d.value]])]),a("div",null,[e[8]||(e[8]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Address line 2",-1)),M(a("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>B.value=o),type:"text",placeholder:"Address line 2",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"},null,512),[[x,B.value]])]),a("div",$,[a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"City *",-1)),M(a("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>p.value=o),type:"text",placeholder:"Sheffield",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",required:""},null,512),[[x,p.value]])]),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"State *",-1)),M(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),type:"text",placeholder:"London",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",required:""},null,512),[[x,g.value]])])]),a("div",X,[a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Country *",-1)),M(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>i.value=o),type:"text",placeholder:"United Kingdom",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",required:""},null,512),[[x,i.value]])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Postcode *",-1)),M(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),type:"text",placeholder:"S1 1AA",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",required:""},null,512),[[x,v.value]])])]),e[15]||(e[15]=a("div",{class:"mt-8"},[a("p",{class:"text-sm font-semibold text-gray-900 mb-4"},"Is the pin in the right location?"),a("p",{class:"text-sm text-gray-600"},"Move the pin to your location")],-1)),a("button",{type:"submit",disabled:I.value||!d.value||!p.value||!g.value||!i.value||!v.value,class:"mt-8 w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2"},[I.value?(N(),P("span",ae)):E("",!0),e[13]||(e[13]=a("span",null,"Save & Continue",-1))],8,ee)],32)]),e[17]||(e[17]=a("div",{class:"w-full lg:w-1/2 relative bg-gray-50 order-first lg:order-last"},[a("div",{id:"map",class:"absolute inset-0 w-full h-full"})],-1))]))}},se=V(oe,[["__scopeId","data-v-41153ad4"]]);export{se as B};
