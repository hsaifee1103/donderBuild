import{l as se,r as v,d as ae,b as oe,J as le,c as re,o,w as ie,I as y,k as M,u as ne,a as e,f as l,g as H,j as de,i as q,v as J,F as R,p as U,t as d,q as O,n as L,z as $}from"./app-ra6n0F-f.js";import{l as ce}from"./index-BJbuQlN4.js";import{P as ue}from"./ProviderDashboardLayout-DeGtjkHh.js";import{B as me}from"./BackIcon-BxF1DEGS.js";import"./NotificationDropdown-cEJAu455.js";import"./x-D73gKmkd.js";const ve={class:"sales-client-list"},pe={class:"header"},fe={class:"search-bar"},ye={class:"list-wrapper"},_e={key:0,class:"loading"},he={key:1,class:"empty"},ge={key:0},Ce={key:1},be={key:2,class:"booking-list"},we=["onClick"],xe={class:"booking-top"},ke={class:"title"},He={class:"cat"},Pe={class:"client"},Be={class:"price"},Ve={class:"booking-body"},Se={class:"service-summary"},Me={class:"schedule"},Le={key:0,class:"fixed inset-0 bg-black/40 backdrop-blur-sm z-60 flex items-end sm:items-center justify-center"},Ne={class:"bg-white w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl shadow-lg overflow-hidden max-h-[95vh]"},Ze={class:"flex justify-between items-center px-4 py-3 border-b border-gray-100"},De=["disabled"],Ee={class:"p-5 border-b border-gray-100"},je={class:"font-medium"},ze={class:"text-xs text-gray-500"},Fe={class:"font-semibold"},Ie={class:"flex justify-between items-center mt-4 font-semibold"},Te={class:"p-5"},Ae={class:"grid grid-cols-2 gap-4"},qe=["disabled"],Je={width:"34",height:"28",viewBox:"0 0 34 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Re=["fill"],Ue=["fill"],Oe=["fill"],$e=["fill"],Ke=["disabled"],We={width:"33",height:"28",viewBox:"0 0 33 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Xe=["fill"],Ge=["disabled"],Qe={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ye={key:1},et={key:2},tt={class:"p-5 border-t"},st={class:"font-semibold"},at={key:1,class:"fixed inset-0 z-70 flex items-end sm:items-center justify-center bg-black/50"},ot={class:"bg-white w-full sm:max-w-md max-h-[95vh] rounded-t-2xl sm:rounded-2xl shadow-xl overflow-y-auto"},lt={class:"flex justify-between items-center px-4 py-3 border-b"},rt=["disabled"],it={class:"p-5 space-y-5"},nt=["disabled"],dt={key:0,id:"card-error",class:"text-red-600 text-sm mt-1"},ct={class:"sticky bottom-0 pt-5 border-t border-gray-100 bg-white"},ut={class:"flex justify-between items-center mb-3 px-1"},mt={class:"font-semibold text-gray-900 text-base"},vt=["disabled"],pt={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ft={key:1},yt={key:2},_t={__name:"SalesClientList",setup(ht){const F=ne(),P=v(!1),m=v(!1),_=v(!1),B=v([]),w=v(""),N=v(!1),V=v(!1),i=v(null),r=v(null),b=v({name:""}),p=v(""),Z=ce("pk_test_51SnNCKAeoTwVR6BPo0LCcZlDptfnv7dlIWUWZisaHH2hIgiqodlfD8np3jKymUkDTHJuR0xHHeJn8mvxwEXbzqrP00jg3nHLOf");let c=null,x=null,f=null;const D=JSON.parse(localStorage.getItem("userData")||"{}"),S=(D==null?void 0:D.id)||null,I=ae(()=>{if(!w.value)return B.value;const a=w.value.trim().toLowerCase();return B.value.filter(t=>((t.customerFirstName||"")+" "+(t.customerLastName||"")).toLowerCase().includes(a)?!0:t.services&&t.services.length?t.services.some(n=>String(n.subcategory_name||n.subCategoryName||n.subcat_name||n.category_name||"").toLowerCase().includes(a)):!1)}),E=async()=>{var a,t;if(!S){y({type:"error",message:"Provider not authenticated"});return}if(!P.value)try{P.value=!0;const s={provider_id:S,status:"pickup_available"},n=await M.post("/getBookingsByProvider",s);if(n.data&&n.data.success){const g=((a=n.data.data)==null?void 0:a.bookings)||[];B.value=g.map(K)}else B.value=[],y({type:"error",message:((t=n.data)==null?void 0:t.errors[0])||"Failed to load bookings"})}catch(s){console.error("fetch pickups error",s),y({type:"error",message:s.message||"Failed to fetch bookings"})}finally{P.value=!1}};function K(a){const t=a.services||a.service_list||[];return{...a,services:t,customerFirstName:a.customer_first_name||a.customerFirstName||a.customer_name||"",customerLastName:a.customer_last_name||a.customerLastName||"",totalPrice:a.total_price||a.totalPrice||a.total_amount||a.totalAmount||"0.00",formattedBookingDate:a.booking_date||a.formattedBookingDate||a.bookingDate,startTime:a.booking_time||a.start_time||a.startTime||"00:00",formattedServiceDuration:t&&t.length&&t[0].service_duration||a.durationDisplay||"1 h"}}function W(){}function X(a){r.value=a,i.value=null,N.value=!0}function j(){m.value||(N.value=!1,r.value=null,i.value=null)}async function G(){i.value="card",await $(),c||(c=await Z,x=c.elements()),f||(f=x.create("card",{hidePostalCode:!0,style:{base:{fontSize:"16px"}}}));const a=document.getElementById("card-element");a&&!a.children.length&&f.mount("#card-element"),p.value="",V.value=!0}function T(){if(f)try{f.unmount()}catch{}V.value=!1,b.value.name="",p.value=""}function A(a){m.value||(i.value=a)}async function Q(){if(!i.value||!r.value){y({type:"warning",message:"Select a payment method first"});return}i.value==="cash"?await Y():i.value==="card"&&G()}async function Y(){var a;if(console.log("pay cash",r.value),!m.value){m.value=!0;try{const t=await M.post("/paymentstatus",{customer_id:r.value.customer_id,provider_id:S,booking_id:r.value.id,status:"completed",message:"payment done",payment_type:"cash"});t.data&&t.data.success?(y({type:"success",message:"Cash payment recorded."}),await E(),j()):y({type:"error",message:((a=t.data)==null?void 0:a.message)||"Failed to record cash payment"})}catch(t){console.error("cash pay error",t),y({type:"error",message:t.message||"Payment error"})}finally{m.value=!1}}}async function ee(){var a,t,s,n,g;if(!_.value){if(!b.value.name){p.value="Card holder name required";return}if(!f||!c){p.value="Card input not initialized";return}_.value=!0,p.value="";try{const{paymentMethod:u,error:h}=await c.createPaymentMethod({type:"card",card:f,billing_details:{name:b.value.name}});if(h){p.value=h.message||"Card validation failed",y({type:"error",message:p.value}),_.value=!1;return}const C=await M.post("/create_payment_intent",{amount:parseFloat(r.value.totalPrice||r.value.total_amount||0),payment_method_id:u.id});if(!C.data||!C.data.success)throw new Error(((a=C.data)==null?void 0:a.message)||"Failed to create payment intent");const k=(t=C.data.data)==null?void 0:t.payment_intent_id,z=await M.post("/capture_payment_intent",{payment_intent_id:k,booking_id:r.value.id,provider_id:S,booking_type:"normal",tap_to_pay:!1,amount:parseFloat(r.value.totalPrice||r.value.total_amount||0)});if(z.data&&z.data.success)y({type:"success",message:"Card payment successful!"}),T(),j(),await E(),F.push({name:"PaymentSuccess",query:{type:"card"}}).catch(()=>{});else throw new Error(((s=z.data)==null?void 0:s.message)||"Capture failed")}catch(u){console.error("card pay error",u);const h=(u==null?void 0:u.message)||((g=(n=u==null?void 0:u.response)==null?void 0:n.data)==null?void 0:g.message)||"Payment failed";p.value=h,y({type:"error",message:h})}finally{_.value=!1}}}function te(){F.back()}return oe(async()=>{c=await Z,x=c==null?void 0:c.elements(),await E()}),le(V,async a=>{if(a){await $(),c||(c=await Z,x=c.elements()),f||(f=x.create("card",{hidePostalCode:!0,style:{base:{fontSize:"16px",color:"#333"}}}));const t=document.getElementById("card-element");t&&!t.children.length&&f.mount("#card-element")}}),(a,t)=>(o(),re(ue,null,{default:ie(()=>[e("div",ve,[e("div",pe,[e("button",{onClick:te,class:"back"},[de(me)]),t[4]||(t[4]=e("h1",null,"Select Booking for Payment",-1))]),e("div",fe,[q(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),onInput:W,placeholder:"Search by service, category or customer name"},null,544),[[J,w.value]])]),e("div",ye,[P.value?(o(),l("div",_e,"Loading bookings…")):I.value.length===0?(o(),l("div",he,[w.value?(o(),l("p",ge,"No result found")):(o(),l("p",Ce,"No booking available for pickup"))])):(o(),l("div",be,[(o(!0),l(R,null,U(I.value,s=>{var n,g,u,h,C;return o(),l("div",{key:s.id,class:"booking-item",onClick:k=>X(s)},[e("div",xe,[e("div",ke,[e("div",He,d(((n=s.services)==null?void 0:n.formattedCategorySummary)||((u=(g=s.services)==null?void 0:g[0])==null?void 0:u.category_name)||"Service"),1),e("div",Pe,d(s.customerFirstName)+" "+d(s.customerLastName||""),1)]),e("div",Be,"£"+d(s.totalPrice||s.total_amount||"0.00"),1)]),e("div",Ve,[e("div",Se,d(((h=s.services)==null?void 0:h.formattedServicesSummary)||((C=s.services)==null?void 0:C.map(k=>k.sub_category_name||k.sub_category_name).join(", "))),1),e("div",Me,[e("div",null,d(s.formattedBookingDate||s.booking_date||s.bookingDate),1),e("div",null,d(s.startTime||s.booking_time)+" • "+d(s.formattedServiceDuration||s.durationDisplay),1)])])],8,we)}),128))]))]),N.value?(o(),l("div",Le,[e("div",Ne,[e("div",Ze,[t[5]||(t[5]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Booking Payment",-1)),e("button",{onClick:j,class:"text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:m.value}," ✕ ",8,De)]),e("div",Ee,[t[7]||(t[7]=e("h3",{class:"font-medium mb-3"},"Order Summary",-1)),(o(!0),l(R,null,U(r.value.services,s=>(o(),l("div",{key:s.subcat_id||s.subCategoryId||s.id,class:"py-3 border-b flex justify-between"},[e("div",null,[e("p",je,d(s.subcategory_name||s.subCategoryName||s.category_name),1),e("p",ze," ⏱ "+d(s.service_duration||s.duration),1)]),e("p",Fe,"£"+d(s.price||s.amount||"0.00"),1)]))),128)),e("div",Ie,[t[6]||(t[6]=e("span",null,"Total to pay",-1)),e("span",null,"£"+d(r.value.totalPrice||r.value.total_amount||"0.00"),1)])]),e("div",Te,[t[11]||(t[11]=e("h3",{class:"font-medium mb-3"},"Payment option",-1)),e("div",Ae,[e("button",{onClick:t[1]||(t[1]=s=>A("cash")),disabled:m.value,class:O(["py-4 border rounded-xl flex flex-col items-center disabled:opacity-50 disabled:cursor-not-allowed",i.value==="cash"?"bg-red-500 text-white border-red-500":"border-gray-300 text-gray-800 hover:bg-gray-50"])},[(o(),l("svg",Je,[e("path",{d:"M18.09 4.67174C18.0687 4.67174 18.0475 4.66834 18.0273 4.66167L3.93101 0.0101818C3.82612 -0.0244309 3.71303 0.0325426 3.67841 0.137436L2.22749 4.53441C2.20045 4.61637 2.12387 4.67174 2.03756 4.67174H0.2C0.0895432 4.67174 0 4.76128 0 4.87174V23.0233C0 23.1337 0.0895431 23.2233 0.2 23.2233H15.044C15.0653 23.2233 15.0864 23.2267 15.1066 23.2334L29.2029 27.8848C29.3078 27.9195 29.4208 27.8625 29.4555 27.7576L30.9064 23.3606C30.9334 23.2786 31.01 23.2233 31.0963 23.2233H32.9339C33.0443 23.2233 33.1339 23.1337 33.1339 23.0233V4.87174C33.1339 4.76128 33.0443 4.67174 32.9339 4.67174H18.09ZM31.1924 8.24562C31.1924 8.38246 31.058 8.47859 30.9329 8.42305C30.2436 8.11693 29.6887 7.56201 29.3826 6.87271C29.327 6.74764 29.4231 6.61318 29.56 6.61318H30.9924C31.1029 6.61318 31.1924 6.70272 31.1924 6.81318V8.24562ZM27.3104 21.1212C27.2887 21.2141 27.207 21.2818 27.1115 21.2818H6.02233C5.92687 21.2818 5.84514 21.2141 5.82347 21.1212C5.39447 19.2805 3.94274 17.8288 2.10204 17.3998C2.00907 17.3781 1.94144 17.2963 1.94144 17.2009V10.6941C1.94144 10.5986 2.00907 10.5169 2.10204 10.4952C3.94275 10.0662 5.39448 8.61449 5.82347 6.77378C5.84514 6.68081 5.92687 6.61318 6.02233 6.61318H27.1115C27.207 6.61318 27.2887 6.68081 27.3104 6.77378C27.7394 8.61449 29.1911 10.0662 31.0318 10.4952C31.1248 10.5169 31.1924 10.5986 31.1924 10.6941V17.2009C31.1924 17.2964 31.1248 17.3781 31.0318 17.3998C29.1911 17.8288 27.7394 19.2805 27.3104 21.1212ZM10.6806 4.28181C10.8964 4.35302 10.8451 4.67174 10.6179 4.67174H4.50318C4.36692 4.67174 4.27055 4.53846 4.31325 4.40907L4.91369 2.58947C4.9483 2.48458 5.06139 2.4276 5.16628 2.46222L10.6806 4.28181ZM3.57388 6.61318C3.71072 6.61318 3.80685 6.74764 3.75131 6.87271C3.44519 7.562 2.89028 8.11688 2.20098 8.42303C2.07591 8.47858 1.94144 8.38245 1.94144 8.2456V6.81318C1.94144 6.70272 2.03098 6.61318 2.14144 6.61318H3.57388ZM1.94144 19.6493C1.94144 19.5125 2.0759 19.4164 2.20097 19.4719C2.89027 19.778 3.44519 20.3329 3.75131 21.0222C3.80685 21.1473 3.71072 21.2818 3.57388 21.2818H2.14144C2.03098 21.2818 1.94144 21.1922 1.94144 21.0818V19.6493ZM22.4533 23.6131C22.2375 23.5419 22.2887 23.2232 22.516 23.2232H28.6307C28.767 23.2232 28.8633 23.3565 28.8206 23.4859L28.2202 25.3055C28.1856 25.4104 28.0725 25.4674 27.9676 25.4327L22.4533 23.6131ZM29.56 21.2818C29.4231 21.2818 29.327 21.1473 29.3826 21.0222C29.6887 20.3329 30.2436 19.778 30.9329 19.4719C31.058 19.4164 31.1924 19.5125 31.1924 19.6493V21.0818C31.1924 21.1922 31.1029 21.2818 30.9924 21.2818H29.56Z",fill:i.value!=="cash"?"#EC5B70":"#fff"},null,8,Re),e("path",{d:"M16.5669 8.9429C13.8074 8.9429 11.5624 11.188 11.5624 13.9475C11.5624 16.707 13.8074 18.9521 16.5669 18.9521C19.3264 18.9521 21.5715 16.707 21.5715 13.9475C21.5715 11.188 19.3265 8.9429 16.5669 8.9429ZM16.5669 17.0106C14.8779 17.0106 13.5038 15.6365 13.5038 13.9475C13.5038 12.2585 14.8779 10.8843 16.5669 10.8843C18.256 10.8843 19.6301 12.2584 19.6301 13.9475C19.6301 15.6365 18.256 17.0106 16.5669 17.0106Z",fill:i.value!=="cash"?"#EC5B70":"#fff"},null,8,Ue),e("path",{d:"M5.15562 13.1768C5.15562 13.0663 5.24516 12.9768 5.35562 12.9768H8.40704C8.5175 12.9768 8.60704 13.0663 8.60704 13.1768V14.7182C8.60704 14.8287 8.5175 14.9182 8.40704 14.9182H5.35562C5.24516 14.9182 5.15562 14.8287 5.15562 14.7182V13.1768Z",fill:i.value!=="cash"?"#EC5B70":"#fff"},null,8,Oe),e("path",{d:"M24.6131 13.1768C24.6131 13.0663 24.7026 12.9768 24.8131 12.9768H27.8645C27.975 12.9768 28.0645 13.0663 28.0645 13.1768V14.7182C28.0645 14.8287 27.975 14.9182 27.8645 14.9182H24.8131C24.7026 14.9182 24.6131 14.8287 24.6131 14.7182V13.1768Z",fill:i.value!=="cash"?"#EC5B70":"#fff"},null,8,$e)])),t[8]||(t[8]=e("span",null,"Cash",-1))],10,qe),e("button",{onClick:t[2]||(t[2]=s=>A("card")),disabled:m.value,class:O(["py-4 border rounded-xl flex flex-col items-center disabled:opacity-50 disabled:cursor-not-allowed",i.value==="card"?"bg-red-500 text-white border-red-500":"border-gray-300 text-gray-800 hover:bg-gray-50"])},[(o(),l("svg",We,[e("path",{d:"M8.90918 0.0996094H28.7637C30.8138 0.099629 32.4814 1.76825 32.4814 3.81836V16.5459C32.4812 18.5958 30.8136 20.2637 28.7637 20.2637H27.3906V24.1816C27.3906 26.2317 25.7229 27.9003 23.6729 27.9004H3.81836C1.76824 27.9004 0.0996094 26.2318 0.0996094 24.1816V11.4541C0.0998499 9.40419 1.76839 7.73633 3.81836 7.73633H23.6729C25.7228 7.7364 27.3904 9.40423 27.3906 11.4541V17.918H28.7637C29.5205 17.9179 30.1365 17.3027 30.1367 16.5459V3.81836C30.1367 3.06136 29.5207 2.44533 28.7637 2.44531H8.90918C8.15217 2.44531 7.53613 3.06135 7.53613 3.81836C7.53604 4.46598 7.01092 4.99121 6.36328 4.99121C5.7158 4.99102 5.19053 4.46586 5.19043 3.81836C5.19043 1.76824 6.85906 0.0996094 8.90918 0.0996094ZM3.81836 10.082C3.0615 10.082 2.44555 10.6973 2.44531 11.4541V24.1816C2.44531 24.9387 3.06135 25.5547 3.81836 25.5547H23.6729C24.4298 25.5546 25.0459 24.9386 25.0459 24.1816V15.1729H6.36328C5.71575 15.1727 5.19043 14.6476 5.19043 14C5.19043 13.3524 5.71575 12.8273 6.36328 12.8271H25.0459V11.4541C25.0457 10.6973 24.4297 10.0821 23.6729 10.082H3.81836ZM16.0361 20.4639H21.127C21.7747 20.4639 22.2998 20.989 22.2998 21.6367C22.2996 22.2843 21.7745 22.8096 21.127 22.8096H16.0361C15.3887 22.8094 14.8635 22.2842 14.8633 21.6367C14.8633 20.9891 15.3885 20.464 16.0361 20.4639Z",fill:i.value!=="card"?"#EC5B70":"#fff",stroke:"white","stroke-width":"0.2"},null,8,Xe)])),t[9]||(t[9]=e("span",null,"Manual card entry",-1))],10,Ke)]),e("button",{onClick:Q,disabled:m.value||!i.value,class:"mt-6 w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 disabled:cursor-not-allowed text-white py-3 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2"},[m.value?(o(),l("svg",Qe,[...t[10]||(t[10]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):H("",!0),m.value?(o(),l("span",et,"Processing...")):(o(),l("span",Ye,"Continue"))],8,Ge)]),e("div",tt,[e("p",st,"Total to Receive £"+d(r.value.totalPrice||r.value.total_amount||"0.00"),1)])])])):H("",!0),V.value?(o(),l("div",at,[e("div",ot,[e("div",lt,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold"},"Manual card entry",-1)),e("button",{onClick:T,class:"text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:_.value}," ✕ ",8,rt)]),e("div",it,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium mb-1"},"Card holder full name",-1)),q(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>b.value.name=s),type:"text",disabled:_.value,class:"w-full border border-gray-300 rounded-lg p-3 focus:ring-red-500 focus:border-red-500 disabled:opacity-50 disabled:cursor-not-allowed"},null,8,nt),[[J,b.value.name]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium mb-1"},"Card details",-1)),t[15]||(t[15]=e("div",{id:"card-element",class:"border border-gray-300 rounded-lg p-3 disabled:opacity-50"},null,-1)),p.value?(o(),l("p",dt,d(p.value),1)):H("",!0)]),t[18]||(t[18]=e("div",{class:"pt-6 border-t border-gray-200"},[e("h4",{class:"text-base font-semibold mb-2"},"How it works"),e("div",{class:"text-sm text-gray-600 space-y-2"},[e("div",null,[e("span",{class:"font-medium text-gray-800"},"Step 1:"),L(" Ask your client for authorisation to process this payment on their card. ")]),e("div",null,[e("span",{class:"font-medium text-gray-800"},"Step 2:"),L(" Add your client's card details for payment. ")]),e("div",null,[e("span",{class:"font-medium text-gray-800"},"Step 3:"),L(" Tap "),e("span",{class:"font-semibold text-red-500"},"Pay Now"),L(" to complete the transaction securely. ")])])],-1)),e("div",ct,[e("div",ut,[t[16]||(t[16]=e("span",{class:"text-gray-700 text-sm font-medium"},"To pay",-1)),e("span",mt,"£"+d(r.value.totalPrice||r.value.total_amount||"0.00"),1)]),e("button",{onClick:ee,disabled:_.value||!b.value.name.trim(),class:"w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 disabled:cursor-not-allowed text-white py-3 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2"},[_.value?(o(),l("svg",pt,[...t[17]||(t[17]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):H("",!0),_.value?(o(),l("span",yt,"Processing...")):(o(),l("span",ft,"Pay Now"))],8,vt)])])])])):H("",!0)])]),_:1}))}},Ht=se(_t,[["__scopeId","data-v-797e1615"]]);export{Ht as default};
