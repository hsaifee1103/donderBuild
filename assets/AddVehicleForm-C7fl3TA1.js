import{l as H,D as J,d as j,r as x,f as c,o as m,g,j as X,a as e,t as f,h as Q,n as v,A as W,i as h,v as S,H as P,E as ee,R as te,F as ae,k as T,I as $}from"./app-BYumhLZY.js";const se={key:0,class:"page"},ie={class:"container"},re={class:"lead"},oe={class:"title text-start"},le={class:"field"},ne={class:"with-icon"},de=["value"],ue=["disabled"],ce={key:0,class:"spinner"},me={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",class:"text-gray-500"},fe={key:0,class:"error-text"},pe={class:"field"},ge={key:0,class:"error-text"},ve={class:"field"},ye={key:0,class:"error-text"},he={class:"field"},be={class:"with-icon"},_e={key:0,class:"error-text"},ke={class:"field"},Ne={class:"with-icon"},we={key:0,class:"error-text"},xe={class:"field"},Se={class:"with-icon"},Te=["max"],Me={key:0,class:"error-text"},Oe={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},Ve={class:"flex items-start"},De={class:"text-sm"},Ce={class:"form-actions"},Re=["disabled"],ze={__name:"AddVehicleForm",props:{isVisible:{type:Boolean,default:!1},errorMessage:{type:String,default:null},formData:{type:Object,default:()=>({})}},emits:["close","submit"],setup(M,{emit:I}){var C,R,z,F,A,E,q,B;const n=M,O=I,k=new Date().getFullYear(),t=J({registrationNumber:((C=n.formData)==null?void 0:C.registrationNumber)||"",postcode:((R=n.formData)==null?void 0:R.postcode)||"Not required",engineSize:((z=n.formData)==null?void 0:z.engineSize)||"",transmission:((F=n.formData)==null?void 0:F.transmission)||"",fuelType:((A=n.formData)==null?void 0:A.fuelType)||"",yearOfRegistration:((E=n.formData)==null?void 0:E.yearOfRegistration)||"",carModel:((q=n.formData)==null?void 0:q.carModel)||"",car_id:((B=n.formData)==null?void 0:B.car_id)||null}),N=j(()=>n.formData.car_id),b=x(!1),V=async()=>{var i,a,o;if(!t.registrationNumber){s.value={registrationNumber:"Please enter a registration number"};return}b.value=!0,s.value={};try{const l=await T.post("/lookup-vehicle",{registrationNumber:t.registrationNumber});if(l.data&&l.data.success){const r=l.data.data;t.carModel=r.make||"",t.yearOfRegistration=r.yearOfManufacture||"",t.engineSize=r.engineCapacity?String(r.engineCapacity):"";const d=(r.fuelType||"").toLowerCase();d.includes("petrol")?t.fuelType="petrol":d.includes("diesel")?t.fuelType="diesel":t.fuelType="",$({type:"success",title:"Vehicle Found",message:"Vehicle details have been populated.",confirmButtonText:"OK"})}else l.status===404||((i=l.data)==null?void 0:i.message)==="Vehicle not found."?s.value={registrationNumber:"Vehicle not found. Please check registration."}:((o=(a=l.data)==null?void 0:a.errors)==null?void 0:o.dvla_status)===400?s.value={registrationNumber:"Invalid registration format. Please check and try again."}:s.value={general:"Failed to lookup vehicle. Please enter manually."}}catch(l){console.error("DVLA Search Error",l),l.response&&l.response.status===404?s.value={registrationNumber:"Vehicle not found. Please check registration."}:s.value={general:"Connection error. Please try again."}}finally{b.value=!1}},L=i=>{let a=i.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"");t.registrationNumber=a},Y=async()=>{var i,a;if(!(!G()||y.value)){y.value=!0,s.value={};try{const o=K();if(!o)throw new Error("User not authenticated");const l={postcode:t.postcode,car_make:t.carModel,car_model:t.registrationNumber,engine_size:t.engineSize,fuelType:t.fuelType,yearOfManufacture:t.yearOfRegistration,user_id:o,transmission:t.transmission};let r;if(N.value?(l.car_id=t.car_id,r=await T.post("/update-car-details",l)):r=await T.post("/car_details",l),r.data&&r.data.success)O("submit",{...t}),D(),$({type:"success",title:N.value?"Vehicle Updated Successfully":"Vehicle Added Successfully",message:r.data.message||(N.value?"Your vehicle details have been updated.":"Your vehicle has been added to your profile."),confirmButtonText:"Great!"});else if(r.data&&r.data.errors){const d=r.data.errors,u={};d.forEach(p=>{const w=p.match(/The (.+?) field/);if(w){const _=w[1],U={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[_];U?u[U]=p:u.general=u.general?`${u.general}; ${p}`:p}else u.general=u.general?`${u.general}; ${p}`:p}),s.value=u}else s.value.general=((i=r.data)==null?void 0:i.message)||"Failed to submit vehicle details. Please try again."}catch(o){if(console.error("Error submitting vehicle form:",o),o.response)if(o.response.status===422){const l=o.response.data.errors||[],r={};l.forEach(d=>{const u=d.match(/The (.+?) field/);if(u){const p=u[1],_={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[p];_?r[_]=d:r.general=r.general?`${r.general}; ${d}`:d}else r.general=r.general?`${r.general}; ${d}`:d}),s.value=r}else s.value.general=((a=o.response.data)==null?void 0:a.message)||"Server error occurred";else o.request?s.value.general="Network error. Please check your connection.":s.value.general=o.message||"An unexpected error occurred"}finally{y.value=!1}}},y=x(!1),s=x({}),K=()=>{const i=localStorage.getItem("userData");return i?JSON.parse(i).id:null},Z=j(()=>!!t.registrationNumber&&!!t.engineSize&&!!t.transmission&&!!t.fuelType&&!!t.yearOfRegistration&&!!t.carModel),G=()=>{const i={};return t.registrationNumber||(i.registrationNumber="Registration number is required"),t.engineSize||(i.engineSize="Engine size is required"),t.transmission?["manual","automatic"].includes(t.transmission)||(i.transmission="Transmission must be manual or automatic"):i.transmission="Transmission is required",t.fuelType?["petrol","diesel"].includes(t.fuelType)||(i.fuelType="Fuel type must be petrol or diesel"):i.fuelType="Fuel type is required",t.yearOfRegistration?(t.yearOfRegistration<1900||t.yearOfRegistration>k)&&(i.yearOfRegistration=`Year must be between 1900 and ${k}`):i.yearOfRegistration="Year of registration is required",t.carModel||(i.carModel="Car model is required"),s.value=i,Object.keys(i).length===0},D=()=>{O("close"),Object.keys(t).forEach(i=>{t[i]=""}),s.value={}};return(i,a)=>(m(),c(ae,null,[M.isVisible?(m(),c("div",se,[e("div",ie,[e("section",re,[e("h1",oe,f(n.formData.car_id?"Edit":"Add")+" Your Car Details",1)]),e("form",{class:"form",onSubmit:Q(Y,["prevent"])},[e("label",le,[a[6]||(a[6]=e("span",null,[v("Registration Number "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",ne,[e("input",{id:"registrationNumber",value:t.registrationNumber,onInput:L,type:"text",placeholder:"e.g. AB12 CDE",required:"",onKeyup:W(V,["enter"])},null,40,de),e("button",{type:"button",onClick:V,class:"trailing-btn",disabled:b.value,title:"Search Vehicle Details"},[b.value?(m(),c("div",ce)):(m(),c("svg",me,[...a[5]||(a[5]=[e("path",{d:"M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))],8,ue)]),s.value.registrationNumber?(m(),c("small",fe,f(s.value.registrationNumber),1)):g("",!0)]),e("label",pe,[a[7]||(a[7]=e("span",null,[v("Car Make "),e("b",{"aria-hidden":"true"},"*")],-1)),h(e("input",{id:"carModel","onUpdate:modelValue":a[0]||(a[0]=o=>t.carModel=o),type:"text",placeholder:"e.g. Fiesta, Corolla, X5",required:""},null,512),[[S,t.carModel,void 0,{trim:!0}]]),s.value.carModel?(m(),c("small",ge,f(s.value.carModel),1)):g("",!0)]),e("label",ve,[a[8]||(a[8]=e("span",null,[v("Engine Size "),e("b",{"aria-hidden":"true"},"*")],-1)),h(e("input",{id:"engineSize","onUpdate:modelValue":a[1]||(a[1]=o=>t.engineSize=o),type:"text",placeholder:"e.g. 1.6L",required:""},null,512),[[S,t.engineSize,void 0,{trim:!0}]]),s.value.engineSize?(m(),c("small",ye,f(s.value.engineSize),1)):g("",!0)]),e("label",he,[a[11]||(a[11]=e("span",null,[v("Transmission "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",be,[h(e("select",{id:"transmission","onUpdate:modelValue":a[2]||(a[2]=o=>t.transmission=o),required:""},[...a[9]||(a[9]=[e("option",{value:""},"Select transmission",-1),e("option",{value:"manual"},"Manual",-1),e("option",{value:"automatic"},"Automatic",-1)])],512),[[P,t.transmission]]),a[10]||(a[10]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),s.value.transmission?(m(),c("small",_e,f(s.value.transmission),1)):g("",!0)]),e("label",ke,[a[14]||(a[14]=e("span",null,[v("Fuel Type "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",Ne,[h(e("select",{id:"fuelType","onUpdate:modelValue":a[3]||(a[3]=o=>t.fuelType=o),required:""},[...a[12]||(a[12]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"petrol"},"Petrol",-1),e("option",{value:"diesel"},"Diesel",-1)])],512),[[P,t.fuelType]]),a[13]||(a[13]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),s.value.fuelType?(m(),c("small",we,f(s.value.fuelType),1)):g("",!0)]),e("label",xe,[a[16]||(a[16]=e("span",null,[v("Year of Registration "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",Se,[h(e("input",{id:"yearOfRegistration","onUpdate:modelValue":a[4]||(a[4]=o=>t.yearOfRegistration=o),type:"number",min:"1900",max:ee(k),placeholder:"e.g. 2020",required:""},null,8,Te),[[S,t.yearOfRegistration]]),a[15]||(a[15]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor","stroke-width":"2"})],-1))]),s.value.yearOfRegistration?(m(),c("small",Me,f(s.value.yearOfRegistration),1)):g("",!0)]),s.value.general?(m(),c("div",Oe,[e("div",Ve,[a[18]||(a[18]=e("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("div",null,[a[17]||(a[17]=e("p",{class:"font-medium"},"Error",-1)),e("p",De,f(s.value.general),1)])])])):g("",!0),e("div",Ce,[e("button",{type:"button",onClick:D,class:"cancel-btn"}," Cancel "),e("button",{type:"submit",class:"submit-btn",disabled:!Z.value||y.value},f(y.value?n.formData.car_id?"Updating Vehicle...":"Adding Vehicle...":n.formData.car_id?"Update Vehicle":"Add Vehicle"),9,Re)])],32)])])):g("",!0),X(te)],64))}},Ee=H(ze,[["__scopeId","data-v-307e8702"]]);export{Ee as A};
