import{l as E,r as o,f as u,o as n,a as s,i as _,v as h,h as M,b as z,k as D,c as S,w as C,u as q,j,g as d,t as f,q as B,n as R,I}from"./app-BPEm73JO.js";import{P as J}from"./ProviderDashboardLayout-DK9selkM.js";import{S as O}from"./SetupLayout-0FL95QF9.js";import"./NotificationDropdown-CEg50caZ.js";import"./x-C6CNGGpS.js";import"./BackIcon-fz9mtqkq.js";import"./IconDocument-DOFrmABf.js";const W={class:"modal-box"},Y={class:"picker-container"},H={__name:"DatePickerModal",emits:["close","select"],setup(T,{emit:P}){const m=P,v=o(new Date().toISOString().substring(0,10)),b=()=>{m("select",v.value)},c=()=>{m("close")};return(y,i)=>(n(),u("div",{class:"modal-overlay",onClick:M(c,["self"])},[s("div",W,[s("div",{class:"modal-header"},[i[1]||(i[1]=s("div",{class:"title"},"Select Established In",-1)),s("button",{class:"done-btn",onClick:b}," Done ")]),s("div",Y,[_(s("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=g=>v.value=g),class:"date-input"},null,512),[[h,v.value]])])])]))}},K=E(H,[["__scopeId","data-v-f9d31941"]]),Q={class:"content-box"},X={class:"white-card"},Z={class:"upload-section"},ee=["src"],se={class:"form-group"},te={key:0,class:"error-message"},ae={class:"form-group"},le={key:0,class:"error-message"},ie={class:"form-group"},oe={key:0,class:"error-message"},ne={class:"form-group"},re={class:"vat-options"},ue={key:0,class:"error-message"},de={key:0,class:"form-group"},ve={key:0,class:"error-message"},ce={key:1,class:"form-group"},pe={key:0,class:"error-message"},me={class:"form-group"},be=["disabled"],ge={key:0},fe={key:1,class:"loading-spinner"},ye={__name:"BusinessInfoScreen",setup(T){const P=q(),m=o("/placeholder-logo.png"),v=o(null),b=o(""),c=o(""),y=o(""),i=o(null),g=o(""),p=o(null),w=o(""),k=o(!1),N=o(!1),l=o({businessName:"",website:"",establishedIn:"",vatRegistered:"",vatNumber:"",vatPercentage:""}),x=o(null),F=JSON.parse(localStorage.getItem("userData")||"{}"),U=()=>{var a;(a=x.value)==null||a.click()},A=a=>{var V;const e=(V=a.target.files)==null?void 0:V[0];if(!e)return;const t=["image/jpeg","image/png","image/jpg","image/gif","image/svg"],r=2*1024*1024;if(!t.includes(e.type)){l.value.businessName="Please upload a valid image file (JPEG, PNG, JPG, GIF, SVG)";return}if(e.size>r){l.value.businessName="Image size should not exceed 2MB";return}v.value=e,m.value=URL.createObjectURL(e),l.value.businessName=""},$=a=>{const e=new Date(a);y.value=e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),k.value=!1},G=()=>{let a=!0;return l.value={businessName:"",website:"",establishedIn:"",vatRegistered:"",vatNumber:"",vatPercentage:""},b.value.trim()||(l.value.businessName="Business name is required",a=!1),y.value||(l.value.establishedIn="Established date is required",a=!1),i.value===null&&(l.value.vatRegistered="Please select if your business is VAT registered",a=!1),i.value===!0&&!g.value.trim()&&(l.value.vatNumber="VAT number is required when VAT registered",a=!1),i.value===!0&&(!p.value||p.value<=0||p.value>100)&&(l.value.vatPercentage="Please enter a valid VAT percentage (0-100)",a=!1),c.value.trim()&&(/^(https?:\/\/)?(www\.)?[a-z0-9\-]+\.[a-z]{2,}(\S*)?$/i.test(c.value)||(l.value.website="Please enter a valid website URL",a=!1)),!v.value&&m.value==="/placeholder-logo.png"&&(l.value.businessName="Business logo is required",a=!1),a},L=async()=>{var a;if(G()){N.value=!0;try{const e=new FormData;e.append("business_name",b.value),e.append("business_website",c.value||""),e.append("established_in",y.value),e.append("vat_no",g.value||""),e.append("companyRegistrationNumber",w.value||""),e.append("has_vat",i.value===!0?"1":"0"),i.value===!0&&p.value&&e.append("vat_percentage",p.value),v.value&&e.append("image",v.value);const t=await D.post("/add-business",e);t.data.success?(I({type:"success",title:"Business Created",message:"Your business information has been saved successfully."}),P.push("/provider/business-hub/location")):I({type:"error",title:"Failed",message:((a=t.data.errors)==null?void 0:a[0])||"Failed to create business."})}catch(e){I({type:"error",title:"Error",message:e.message||"Something went wrong."})}N.value=!1}};return z(async()=>{try{const a=F.id;if(!a){console.error("Provider ID not found");return}const e=await D.post("/provider/profile",{provider_id:a});if(e.data){const t=e.data.data;if(console.log("Fetched provider data:",t),t.businesses&&t.businesses.length>0){const r=t.businesses[0];console.log("Fetched business data:",r),b.value=r.business_name||"",c.value=r.business_website||"",y.value=r.established_in||"",i.value=!!r.vat_no,g.value=r.vat_no||"",w.value=r.companyRegistrationNumber||"",t.has_vat&&t.vat_percentage&&(p.value=t.vat_percentage),r.file_id&&(m.value=r.file_id)}}}catch(a){console.error("Error fetching business info:",a)}}),(a,e)=>(n(),S(J,null,{default:C(()=>[j(O,null,{default:C(()=>[s("div",Q,[e[19]||(e[19]=s("h1",{class:"content-title"},"Business information",-1)),e[20]||(e[20]=s("p",{class:"content-subtitle"}," This is the business information that customers will see when browsing. Please fill in the correct information as your legal documents for verification. ",-1)),s("div",X,[s("div",Z,[s("img",{src:m.value,class:"upload-preview"},null,8,ee),s("button",{class:"upload-btn",onClick:U}," Upload Business Logo "),s("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/*",class:"hidden",onChange:A},null,544)]),s("div",se,[e[9]||(e[9]=s("label",{class:"label"},"What's your business name? *",-1)),_(s("input",{type:"text",class:"input","onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),placeholder:"Ex: my garage solution"},null,512),[[h,b.value]]),l.value.businessName?(n(),u("div",te,f(l.value.businessName),1)):d("",!0)]),s("div",ae,[e[10]||(e[10]=s("label",{class:"label"},"What's your business website? (optional)",-1)),_(s("input",{type:"text",class:"input","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),placeholder:"Ex: www.mybusiness.com"},null,512),[[h,c.value]]),l.value.website?(n(),u("div",le,f(l.value.website),1)):d("",!0)]),s("div",ie,[e[11]||(e[11]=s("label",{class:"label"},"Established In *",-1)),s("div",{class:"date-input",onClick:e[2]||(e[2]=t=>k.value=!0)},f(y.value||"Ex: 20 May 1996"),1),l.value.establishedIn?(n(),u("div",oe,f(l.value.establishedIn),1)):d("",!0)]),s("div",ne,[e[14]||(e[14]=s("label",{class:"label"},"Is your business VAT registered?",-1)),s("div",re,[s("div",{class:B(["radio-option",{active:i.value===!0}]),onClick:e[3]||(e[3]=t=>i.value=!0)},[...e[12]||(e[12]=[s("div",{class:"radio-dot"},null,-1),R(" Yes ",-1)])],2),s("div",{class:B(["radio-option",{active:i.value===!1}]),onClick:e[4]||(e[4]=t=>i.value=!1)},[...e[13]||(e[13]=[s("div",{class:"radio-dot"},null,-1),R(" No ",-1)])],2)]),l.value.vatRegistered?(n(),u("div",ue,f(l.value.vatRegistered),1)):d("",!0)]),i.value===!0?(n(),u("div",de,[e[15]||(e[15]=s("label",{class:"label"},"VAT number*",-1)),_(s("input",{type:"text",class:"input",maxlength:"9",placeholder:"GB123456789","onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t)},null,512),[[h,g.value]]),l.value.vatNumber?(n(),u("div",ve,f(l.value.vatNumber),1)):d("",!0)])):d("",!0),i.value===!0?(n(),u("div",ce,[e[16]||(e[16]=s("label",{class:"label"},"VAT Percentage (%) *",-1)),_(s("input",{type:"number",class:"input",min:"0",max:"100",step:"0.01",placeholder:"e.g., 20","onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t)},null,512),[[h,p.value,void 0,{number:!0}]]),e[17]||(e[17]=s("p",{class:"field-hint"},"Enter your VAT rate as a percentage (e.g., 20 for 20%)",-1)),l.value.vatPercentage?(n(),u("div",pe,f(l.value.vatPercentage),1)):d("",!0)])):d("",!0),s("div",me,[e[18]||(e[18]=s("label",{class:"label"},"Company registration number (optional)",-1)),_(s("input",{type:"text",class:"input",maxlength:"8",placeholder:"Enter company registration number","onUpdate:modelValue":e[7]||(e[7]=t=>w.value=t)},null,512),[[h,w.value]])]),s("button",{class:"save-btn",onClick:L,disabled:N.value},[N.value?(n(),u("span",fe)):(n(),u("span",ge,"Continue"))],8,be)])]),k.value?(n(),S(K,{key:0,onClose:e[8]||(e[8]=t=>k.value=!1),onSelect:$})):d("",!0)]),_:1})]),_:1}))}},xe=E(ye,[["__scopeId","data-v-489a453c"]]);export{xe as default};
