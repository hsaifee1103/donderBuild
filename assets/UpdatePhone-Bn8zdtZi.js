import{r as l,b as j,c as F,o as u,w as K,y as L,u as z,a,f as v,g as b,t as c,i as w,j as R,v as P,F as U,p as V,A as D,k as A}from"./app-CTtqvBQy.js";import{P as T}from"./ProviderDashboardLayout-Bpkv7GAz.js";import{C as G}from"./CountrySelector-C2vfKOom.js";import"./NotificationDropdown-BoJJU9Nh.js";import"./x-DpUPLwB8.js";import"./countries-DXaTS7mb.js";/* empty css                                                                        */const J={class:"max-w-7xl mx-auto"},W={class:"bg-white rounded-lg overflow-hidden mt-6"},Y={class:"p-6"},$={key:0,class:"mb-6 p-4 bg-green-50 text-green-700 rounded-lg"},q={class:"flex items-start"},H={key:1,class:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg"},Q={class:"flex items-start"},X={key:2},Z={class:"mb-6"},ee={class:"flex"},re={class:"w-1/4 mr-2"},ae={class:"flex justify-end"},te=["disabled"],oe={key:3},se={class:"mb-6"},ne={class:"mb-4"},le={class:"text-sm font-medium text-gray-700 mb-2"},ie={class:"flex space-x-2"},de=["onUpdate:modelValue","onInput","onKeydown"],ue={class:"text-sm font-medium text-gray-700 mb-2"},ce={class:"flex space-x-2"},ve=["onUpdate:modelValue","onInput","onKeydown"],fe={class:"flex justify-between"},pe=["disabled"],me=["disabled"],Ae={__name:"UpdatePhone",setup(ge){const k=z(),_=l(1),C=l(""),i=l(""),f=l(["","","",""]),p=l(["","","",""]),d=l({name:"United Kingdom",dial_code:"+44",code:"GB",flag:"gb"}),m=l(!1),x=l(""),t=l(""),g=l(!1),y=l(!1),h=l(!1),I=async()=>{try{await L();const o=localStorage.getItem("userData");if(o)try{const e=JSON.parse(o);if(C.value=e.mobile||"",e.country_code){const s=B.find(r=>r.dial_code===e.country_code);s&&(d.value=s)}}catch(e){console.error("Error parsing user data:",e)}}catch(o){console.error("Error loading user data:",o)}},N=(o,e,s)=>{const r=s.target.value;if(!/^\d*$/.test(r)){s.target.value="";return}if(r&&e<3){const n=s.target.nextElementSibling;n&&n.focus()}},S=(o,e,s)=>{if(!s.target.value&&e>0){const r=s.target.previousElementSibling;r&&r.focus()}},E=async()=>{if(!i.value.trim()){t.value="Please enter a valid phone number";return}g.value=!0,t.value="";try{const o=d.value.dial_code+i.value,e=await A.post("/send-verification-otp",{type:"provider",entity:"phone",value:o});e.data&&e.data.success?(_.value=2,f.value=["","","",""],p.value=["","","",""]):e.data.errors&&Array.isArray(e.data.errors)&&e.data.errors.length>0?t.value=e.data.errors[0]:e.data.message?t.value=e.data.message:t.value="Failed to send verification code. Please try again."}catch(o){if(console.error("Error sending verification code:",o),o.response&&o.response.data){const e=o.response.data;e.errors&&Array.isArray(e.errors)&&e.errors.length>0?t.value=e.errors[0]:e.message?t.value=e.message:t.value="An error occurred while sending verification code. Please try again."}else t.value="An error occurred while sending verification code. Please try again."}finally{g.value=!1}},M=async()=>{y.value=!0,t.value="";try{const o=d.value.dial_code+i.value,e=await A.post("/send-verification-otp",{type:"provider",entity:"phone",value:o});e.data&&e.data.success?(f.value=["","","",""],p.value=["","","",""],x.value="Verification code has been resent.",m.value=!0,setTimeout(()=>{m.value=!1},3e3)):e.data.errors&&Array.isArray(e.data.errors)&&e.data.errors.length>0?t.value=e.data.errors[0]:e.data.message?t.value=e.data.message:t.value="Failed to resend verification code. Please try again."}catch(o){if(console.error("Error resending verification code:",o),o.response&&o.response.data){const e=o.response.data;e.errors&&Array.isArray(e.errors)&&e.errors.length>0?t.value=e.errors[0]:e.message?t.value=e.message:t.value="An error occurred while resending verification code. Please try again."}else t.value="An error occurred while resending verification code. Please try again."}finally{y.value=!1}},O=async()=>{const o=f.value.join(""),e=p.value.join("");if(o.length!==4||e.length!==4){t.value="Please enter complete verification codes";return}h.value=!0,t.value="";try{const s=d.value.dial_code+i.value,r=await A.post("/verify-and-update",{type:"provider",entity:"phone",value:s});if(r.data&&r.data.success){const n=JSON.parse(localStorage.getItem("userData")||"{}");n.mobile=i.value,n.country_code=d.value.dial_code,localStorage.setItem("userData",JSON.stringify(n)),x.value="Your phone number has been updated successfully!",m.value=!0,setTimeout(()=>{k.push("/provider/profile")},2e3)}else r.data.errors&&Array.isArray(r.data.errors)&&r.data.errors.length>0?t.value=r.data.errors[0]:r.data.message?t.value=r.data.message:t.value="Failed to verify and update phone number. Please try again."}catch(s){if(console.error("Error verifying and updating phone:",s),s.response&&s.response.data){const r=s.response.data;r.errors&&Array.isArray(r.errors)&&r.errors.length>0?t.value=r.errors[0]:r.message?t.value=r.message:t.value="An error occurred while verifying and updating your phone number. Please try again."}else t.value="An error occurred while verifying and updating your phone number. Please try again."}finally{h.value=!1}},B=[{name:"United Kingdom",dial_code:"+44",code:"GB",flag:"gb"},{name:"United States",dial_code:"+1",code:"US",flag:"us"},{name:"India",dial_code:"+91",code:"IN",flag:"in"},{name:"Germany",dial_code:"+49",code:"DE",flag:"de"},{name:"France",dial_code:"+33",code:"FR",flag:"fr"},{name:"Australia",dial_code:"+61",code:"AU",flag:"au"}];return j(()=>{I()}),(o,e)=>(u(),F(T,null,{default:K(()=>[a("div",J,[e[8]||(e[8]=a("div",{class:"mt-5"},[a("h1",{class:"text-2xl px-6 font-bold text-gray-900"},"Update Phone Number")],-1)),a("div",W,[a("div",Y,[m.value?(u(),v("div",$,[a("div",q,[e[2]||(e[2]=a("svg",{class:"h-5 w-5 text-green-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),a("p",null,c(x.value),1)])])):b("",!0),t.value?(u(),v("div",H,[a("div",Q,[e[3]||(e[3]=a("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),a("p",null,c(t.value),1)])])):b("",!0),_.value===1?(u(),v("div",X,[e[4]||(e[4]=a("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Enter New Phone Number",-1)),e[5]||(e[5]=a("p",{class:"text-gray-600 mb-6"},"Please enter your new mobile number to replace the existing one on your account.",-1)),a("div",Z,[a("div",ee,[a("div",re,[R(G,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s)},null,8,["modelValue"])]),w(a("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),type:"tel",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Enter phone number"},null,512),[[P,i.value]])])]),a("div",ae,[a("button",{onClick:E,class:"px-6 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium",disabled:g.value||!i.value.trim()},c(g.value?"Sending...":"Continue"),9,te)])])):b("",!0),_.value===2?(u(),v("div",oe,[e[6]||(e[6]=a("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Mobile Number Verification",-1)),e[7]||(e[7]=a("p",{class:"text-gray-600 mb-6"}," We've sent a 4-digit verification code to both your current and new mobile numbers. Please enter the codes below to complete the verification process. ",-1)),a("div",se,[a("div",ne,[a("p",le,"Current Mobile Number OTP: "+c(d.value.dial_code)+" "+c(C.value),1),a("div",ie,[(u(!0),v(U,null,V(f.value,(s,r)=>w((u(),v("input",{key:r,"onUpdate:modelValue":n=>f.value[r]=n,type:"text",maxlength:"1",class:"w-12 h-12 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:n=>N("current",r,n),onKeydown:D(n=>S("current",r,n),["delete"])},null,40,de)),[[P,f.value[r]]])),128))])]),a("div",null,[a("p",ue,"New Mobile Number OTP: "+c(d.value.dial_code)+" "+c(i.value),1),a("div",ce,[(u(!0),v(U,null,V(p.value,(s,r)=>w((u(),v("input",{key:r,"onUpdate:modelValue":n=>p.value[r]=n,type:"text",maxlength:"1",class:"w-12 h-12 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",onInput:n=>N("new",r,n),onKeydown:D(n=>S("new",r,n),["delete"])},null,40,ve)),[[P,p.value[r]]])),128))])])]),a("div",fe,[a("button",{onClick:M,class:"px-4 py-2 text-red-500 hover:text-red-600 font-medium",disabled:y.value},c(y.value?"Resending...":"Resend Code"),9,pe),a("button",{onClick:O,class:"px-6 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium",disabled:h.value||f.value.join("").length!==4||p.value.join("").length!==4},c(h.value?"Verifying...":"Continue"),9,me)])])):b("",!0)])])])]),_:1}))}};export{Ae as default};
