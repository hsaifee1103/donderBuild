import{l as H,D as J,d as j,r as S,f as d,o as u,g as p,j as X,a as e,t as c,h as Z,n as g,i as v,v as k,A as Q,H as $,E as W,R as ee,F as te,k as T,I as L}from"./app-7omrHMIl.js";const ae={key:0,class:"page"},se={class:"container"},ie={class:"lead"},re={class:"title text-start"},oe={class:"field"},le={class:"with-icon"},ne=["disabled"],de={key:0,class:"spinner"},ue={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",class:"text-gray-500"},ce={key:0,class:"error-text"},me={class:"field"},fe={key:0,class:"error-text"},pe={class:"field"},ge={key:0,class:"error-text"},ve={class:"field"},ye={class:"with-icon"},he={key:0,class:"error-text"},be={class:"field"},_e={class:"with-icon"},ke={key:0,class:"error-text"},Ne={class:"field"},we={class:"with-icon"},xe=["max"],Se={key:0,class:"error-text"},Te={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},Me={class:"flex items-start"},Ve={class:"text-sm"},Oe={class:"form-actions"},De=["disabled"],Ce={__name:"AddVehicleForm",props:{isVisible:{type:Boolean,default:!1},errorMessage:{type:String,default:null},formData:{type:Object,default:()=>({})}},emits:["close","submit"],setup(M,{emit:P}){var C,z,R,F,E,q,A,B;const l=M,V=P,N=new Date().getFullYear(),a=J({registrationNumber:((C=l.formData)==null?void 0:C.registrationNumber)||"",postcode:((z=l.formData)==null?void 0:z.postcode)||"Not required",engineSize:((R=l.formData)==null?void 0:R.engineSize)||"",transmission:((F=l.formData)==null?void 0:F.transmission)||"",fuelType:((E=l.formData)==null?void 0:E.fuelType)||"",yearOfRegistration:((q=l.formData)==null?void 0:q.yearOfRegistration)||"",carModel:((A=l.formData)==null?void 0:A.carModel)||"",car_id:((B=l.formData)==null?void 0:B.car_id)||null}),w=j(()=>l.formData.car_id),b=S(!1),O=async()=>{if(!a.registrationNumber){i.value={registrationNumber:"Please enter a registration number"};return}b.value=!0,i.value={};try{const s=await T.post("/lookup-vehicle",{registrationNumber:a.registrationNumber.replace(/\s/g,"").toUpperCase()});if(s.data&&s.data.success){const t=s.data.data;a.carModel=t.make||"",a.yearOfRegistration=t.yearOfManufacture||"",a.engineSize=t.engineCapacity?String(t.engineCapacity):"";const r=(t.fuelType||"").toLowerCase();r.includes("petrol")?a.fuelType="petrol":r.includes("diesel")?a.fuelType="diesel":a.fuelType="",L({type:"success",title:"Vehicle Found",message:"Vehicle details have been populated.",confirmButtonText:"OK"})}else s.status===404||s.data&&!s.data.success&&s.data.message==="Vehicle not found."?i.value={registrationNumber:"Vehicle not found. Please check registration."}:i.value={general:"Failed to lookup vehicle. Please enter manually."}}catch(s){console.error("DVLA Search Error",s),s.response&&s.response.status===404?i.value={registrationNumber:"Vehicle not found. Please check registration."}:i.value={general:"Connection error. Please try again."}}finally{b.value=!1}},Y=async()=>{var s,t;if(!(!G()||y.value)){y.value=!0,i.value={};try{const r=I();if(!r)throw new Error("User not authenticated");const h={postcode:a.postcode,car_make:a.carModel,car_model:a.registrationNumber,engine_size:a.engineSize,fuelType:a.fuelType,yearOfManufacture:a.yearOfRegistration,user_id:r,transmission:a.transmission};let o;if(w.value?(h.car_id=a.car_id,o=await T.post("/update-car-details",h)):o=await T.post("/car_details",h),o.data&&o.data.success)V("submit",{...a}),D(),L({type:"success",title:w.value?"Vehicle Updated Successfully":"Vehicle Added Successfully",message:o.data.message||(w.value?"Your vehicle details have been updated.":"Your vehicle has been added to your profile."),confirmButtonText:"Great!"});else if(o.data&&o.data.errors){const m=o.data.errors,n={};m.forEach(f=>{const x=f.match(/The (.+?) field/);if(x){const _=x[1],U={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[_];U?n[U]=f:n.general=n.general?`${n.general}; ${f}`:f}else n.general=n.general?`${n.general}; ${f}`:f}),i.value=n}else i.value.general=((s=o.data)==null?void 0:s.message)||"Failed to submit vehicle details. Please try again."}catch(r){if(console.error("Error submitting vehicle form:",r),r.response)if(r.response.status===422){const h=r.response.data.errors||[],o={};h.forEach(m=>{const n=m.match(/The (.+?) field/);if(n){const f=n[1],_={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[f];_?o[_]=m:o.general=o.general?`${o.general}; ${m}`:m}else o.general=o.general?`${o.general}; ${m}`:m}),i.value=o}else i.value.general=((t=r.response.data)==null?void 0:t.message)||"Server error occurred";else r.request?i.value.general="Network error. Please check your connection.":i.value.general=r.message||"An unexpected error occurred"}finally{y.value=!1}}},y=S(!1),i=S({}),I=()=>{const s=localStorage.getItem("userData");return s?JSON.parse(s).id:null},K=j(()=>!!a.registrationNumber&&!!a.engineSize&&!!a.transmission&&!!a.fuelType&&!!a.yearOfRegistration&&!!a.carModel),G=()=>{const s={};return a.registrationNumber||(s.registrationNumber="Registration number is required"),a.engineSize||(s.engineSize="Engine size is required"),a.transmission?["manual","automatic"].includes(a.transmission)||(s.transmission="Transmission must be manual or automatic"):s.transmission="Transmission is required",a.fuelType?["petrol","diesel"].includes(a.fuelType)||(s.fuelType="Fuel type must be petrol or diesel"):s.fuelType="Fuel type is required",a.yearOfRegistration?(a.yearOfRegistration<1900||a.yearOfRegistration>N)&&(s.yearOfRegistration=`Year must be between 1900 and ${N}`):s.yearOfRegistration="Year of registration is required",a.carModel||(s.carModel="Car model is required"),i.value=s,Object.keys(s).length===0},D=()=>{V("close"),Object.keys(a).forEach(s=>{a[s]=""}),i.value={}};return(s,t)=>(u(),d(te,null,[M.isVisible?(u(),d("div",ae,[e("div",se,[e("section",ie,[e("h1",re,c(l.formData.car_id?"Edit":"Add")+" Your Car Details",1)]),e("form",{class:"form",onSubmit:Z(Y,["prevent"])},[e("label",oe,[t[7]||(t[7]=e("span",null,[g("Registration Number "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",le,[v(e("input",{id:"registrationNumber","onUpdate:modelValue":t[0]||(t[0]=r=>a.registrationNumber=r),type:"text",placeholder:"e.g. AB12 CDE",required:"",onKeyup:Q(O,["enter"])},null,544),[[k,a.registrationNumber,void 0,{trim:!0}]]),e("button",{type:"button",onClick:O,class:"trailing-btn",disabled:b.value,title:"Search Vehicle Details"},[b.value?(u(),d("div",de)):(u(),d("svg",ue,[...t[6]||(t[6]=[e("path",{d:"M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))],8,ne)]),i.value.registrationNumber?(u(),d("small",ce,c(i.value.registrationNumber),1)):p("",!0)]),e("label",me,[t[8]||(t[8]=e("span",null,[g("Car Make "),e("b",{"aria-hidden":"true"},"*")],-1)),v(e("input",{id:"carModel","onUpdate:modelValue":t[1]||(t[1]=r=>a.carModel=r),type:"text",placeholder:"e.g. Fiesta, Corolla, X5",required:""},null,512),[[k,a.carModel,void 0,{trim:!0}]]),i.value.carModel?(u(),d("small",fe,c(i.value.carModel),1)):p("",!0)]),e("label",pe,[t[9]||(t[9]=e("span",null,[g("Engine Size "),e("b",{"aria-hidden":"true"},"*")],-1)),v(e("input",{id:"engineSize","onUpdate:modelValue":t[2]||(t[2]=r=>a.engineSize=r),type:"text",placeholder:"e.g. 1.6L",required:""},null,512),[[k,a.engineSize,void 0,{trim:!0}]]),i.value.engineSize?(u(),d("small",ge,c(i.value.engineSize),1)):p("",!0)]),e("label",ve,[t[12]||(t[12]=e("span",null,[g("Transmission "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",ye,[v(e("select",{id:"transmission","onUpdate:modelValue":t[3]||(t[3]=r=>a.transmission=r),required:""},[...t[10]||(t[10]=[e("option",{value:""},"Select transmission",-1),e("option",{value:"manual"},"Manual",-1),e("option",{value:"automatic"},"Automatic",-1)])],512),[[$,a.transmission]]),t[11]||(t[11]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),i.value.transmission?(u(),d("small",he,c(i.value.transmission),1)):p("",!0)]),e("label",be,[t[15]||(t[15]=e("span",null,[g("Fuel Type "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",_e,[v(e("select",{id:"fuelType","onUpdate:modelValue":t[4]||(t[4]=r=>a.fuelType=r),required:""},[...t[13]||(t[13]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"petrol"},"Petrol",-1),e("option",{value:"diesel"},"Diesel",-1)])],512),[[$,a.fuelType]]),t[14]||(t[14]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),i.value.fuelType?(u(),d("small",ke,c(i.value.fuelType),1)):p("",!0)]),e("label",Ne,[t[17]||(t[17]=e("span",null,[g("Year of Registration "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",we,[v(e("input",{id:"yearOfRegistration","onUpdate:modelValue":t[5]||(t[5]=r=>a.yearOfRegistration=r),type:"number",min:"1900",max:W(N),placeholder:"e.g. 2020",required:""},null,8,xe),[[k,a.yearOfRegistration]]),t[16]||(t[16]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor","stroke-width":"2"})],-1))]),i.value.yearOfRegistration?(u(),d("small",Se,c(i.value.yearOfRegistration),1)):p("",!0)]),i.value.general?(u(),d("div",Te,[e("div",Me,[t[19]||(t[19]=e("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("div",null,[t[18]||(t[18]=e("p",{class:"font-medium"},"Error",-1)),e("p",Ve,c(i.value.general),1)])])])):p("",!0),e("div",Oe,[e("button",{type:"button",onClick:D,class:"cancel-btn"}," Cancel "),e("button",{type:"submit",class:"submit-btn",disabled:!K.value||y.value},c(y.value?l.formData.car_id?"Updating Vehicle...":"Adding Vehicle...":l.formData.car_id?"Update Vehicle":"Add Vehicle"),9,De)])],32)])])):p("",!0),X(ee)],64))}},Fe=H(Ce,[["__scopeId","data-v-d2ce7ad6"]]);export{Fe as A};
