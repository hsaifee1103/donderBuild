import{b as $,r as m,d as S,e as E,c as V,o as g,w as M,u as L,a as s,f,g as y,t as b,h as T,i as O,j as G,v as q,k as x,_ as R,s as C}from"./app-BYumhLZY.js";import{_ as D}from"./AuthLayout-B46Dl5mV.js";import{C as Z}from"./CountrySelector-BRojR4rM.js";import"./countries-DXaTS7mb.js";/* empty css                                                                        */const J={class:"text-center mb-8"},K={class:"text-gray-600 text-lg"},Y={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},W={key:1,class:"mb-4 p-3 bg-yellow-50 text-yellow-700 rounded-lg"},Q={class:"flex items-start"},X={class:"text-sm"},ee={class:"flex space-x-2"},te={class:"w-[88px] flex-none"},ae=["disabled"],oe={key:2,class:"my-8 relative text-center"},se={key:3,class:"space-y-4"},de={__name:"MobileLogin",setup(re){const N=E(),d=L();$(()=>{k(),B()});const i=m(""),p=m(!1),r=m(""),v=m(""),n=m({name:"United Kingdom",dial_code:"+44",code:"GB",flag:"gb"}),c=S(()=>N.params.userType),I=S(()=>c.value==="customer"?"car services":"garage business"),F=(o,e)=>{const t=o.replace(/\D/g,"");return e==="+91"?/^[6-9]\d{9}$/.test(t):e==="+44"?/^\d{10,11}$/.test(t):/^\d{6,15}$/.test(t)},z=async()=>{if(r.value="",v.value="",!F(i.value,n.value.dial_code)){r.value=`Please enter a valid mobile number for ${n.value.name}.`;return}if(i.value.trim()){p.value=!0;try{const o={country_code:n.value.dial_code,mobile:i.value,usertype:c.value==="customer"?"cust":"garage",fcm_token:"eOJLsFzYdUeimHNV8fY_m8:APA91bHiKHyu4IZdPLIPuAcUeWw_85-ieyNT3oRvFHMbVeL9_nG7zCpi51eEvyybZiN8GEsHxOvzlvuVBypruqxd-n4q6aZhyi58ucpeGTDWLiSXU8BQaH8"};console.log("Checking user with data:",o);const e=await x.post("/signup",o);if(console.log("Signup API response:",e.data),e.data&&e.data.success&&e.data.data){if(e.data.data.customer&&e.data.data.customer.isUserExist===1){const{first_name:t,last_name:a}=e.data.data.customer;d.push({path:`/login/password/${c.value}`,query:{contact:i.value,countryCode:n.value.dial_code,mobile:i.value,userName:`${t} ${a}`,userData:JSON.stringify(e.data.data.customer)}});return}if(e.data.data.provider&&e.data.data.provider.isUserExist===1){const{first_name:t,last_name:a}=e.data.data.provider;d.push({path:`/login/password/${c.value}`,query:{contact:i.value,countryCode:n.value.dial_code,mobile:i.value,userName:`${t} ${a}`,userData:JSON.stringify(e.data.data.provider)}});return}v.value=`No account found with ${n.value.dial_code} ${i.value}. Please create an account first.`,c.value==="garage"?d.push({path:`/signup/garage-info/${c.value}`,query:{contact:i.value,countryCode:n.value.dial_code,mobile:i.value}}):d.push({path:`/signup/otp/${c.value}`,query:{contact:i.value,countryCode:n.value.dial_code,mobile:i.value}});return}else{const t=e.data.errors||[];Array.isArray(t)?r.value=t.join(", "):typeof t=="object"?r.value=Object.values(t).flat().join(", "):r.value="Invalid input data."}}catch(o){if(console.error("Error checking user:",o),o.response){const e=o.response.status,t=o.response.data;if(e===422){const a=t.errors||[];Array.isArray(a)?r.value=a.join(", "):typeof a=="object"?r.value=Object.values(a).flat().join(", "):r.value="Invalid input data."}else r.value=t.message||"An error occurred while checking user information."}else o.request?r.value="Network error. Please check your connection.":r.value="An unexpected error occurred."}finally{p.value=!1}}},h=async o=>{if(o==="google")try{const e=await R();if(e.access_token){const a=await(await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}})).json();await _({social_type:"google",social_id:a.sub,email:a.email,first_name:a.given_name,last_name:a.family_name,social_image:a.picture})}}catch(e){console.error("Google login error:",e),r.value="Failed to sign in with Google."}else if(o==="apple")try{const e=await AppleID.auth.signIn();if(console.log("Apple Sign-In response:",e),e&&e.authorization&&e.authorization.id_token){let t="",a="",l="";e.user&&(e.user.name&&(t=e.user.name.firstName||"",a=e.user.name.lastName||""),l=e.user.email||"");const U=e.authorization.id_token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),H=decodeURIComponent(window.atob(U).split("").map(function(P){return"%"+("00"+P.charCodeAt(0).toString(16)).slice(-2)}).join("")),A=JSON.parse(H),j=A.sub;l||(l=A.email||""),await _({social_type:"apple",social_id:j,email:l,first_name:t||"Apple",last_name:a||"User",social_image:""})}}catch(e){console.error("Apple login error:",e),r.value="Failed to sign in with Apple."}else if(o==="facebook")try{console.log("Starting Facebook login..."),await k(),FB.login(e=>{console.log("FB.login response:",e),e.authResponse?FB.api("/me",{fields:"id,name,first_name,last_name,email,picture.type(large)"},t=>{var a,l;_({social_type:"facebook",social_id:t.id,email:t.email,first_name:t.first_name,last_name:t.last_name,social_image:(l=(a=t.picture)==null?void 0:a.data)==null?void 0:l.url})}):console.log("User cancelled login or did not authorize.")},{scope:"public_profile,email"})}catch(e){console.error("Facebook login error:",e),r.value="Failed to sign in with Facebook."}},k=()=>new Promise(o=>{if(window.FB){console.log("Facebook SDK already loaded"),o();return}console.log("Initializing Facebook SDK..."),window.fbAsyncInit=function(){const e="1231173615524024";console.log("Facebook App ID:",e),FB.init({appId:e,cookie:!0,xfbml:!0,version:"v18.0"}),console.log("Facebook SDK initialized"),o()},function(e,t,a){var l,u=e.getElementsByTagName(t)[0];e.getElementById(a)||(l=e.createElement(t),l.id=a,l.src="https://connect.facebook.net/en_US/sdk.js",u.parentNode.insertBefore(l,u))}(document,"script","facebook-jssdk")}),B=()=>{const o="apple-jssdk";if(document.getElementById(o))return;const e=document.createElement("script");e.id=o,e.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",e.onload=()=>{AppleID.auth.init({clientId:"web.donderstorm.signin",scope:"name email",redirectURI:"https://dev.donderstorm.com/apple-callback",state:"origin:web",usePopup:!0}),console.log("Apple SDK initialized")},document.head.appendChild(e)},_=async o=>{p.value=!0;try{const t={social_type:o.social_type,social_id:o.social_id,fcm_token:"eOJLsFzYdUeimHNV8fY_m8:APA91bHiKHyu4IZdPLIPuAcUeWw_85-ieyNT3oRvFHMbVeL9_nG7zCpi51eEvyybZiN8GEsHxOvzlvuVBypruqxd-n4q6aZhyi58ucpeGTDWLiSXU8BQaH8"},a=await x.post("/checkSocialLogin",t);if(a.data&&a.data.success)if(a.data.data&&a.data.data.customer){const{token:l,customer:u}=a.data.data;l&&(localStorage.setItem("authToken",l),C(l)),localStorage.setItem("userData",JSON.stringify(u)),localStorage.setItem("userType","customer"),d.push("/personal-info")}else await w(o);else a.data.message==="User not found"||!a.data.data?await w(o):r.value=a.data.message||"Failed to check social account."}catch(e){console.error("Check social account error:",e),e.response&&e.response.status===404?await w(o):r.value="An error occurred during social login."}finally{p.value=!1}},w=async o=>{try{const t={first_name:o.first_name,last_name:o.last_name,email:o.email,social_type:o.social_type,social_id:o.social_id,social_image:o.social_image,fcm_token:"eOJLsFzYdUeimHNV8fY_m8:APA91bHiKHyu4IZdPLIPuAcUeWw_85-ieyNT3oRvFHMbVeL9_nG7zCpi51eEvyybZiN8GEsHxOvzlvuVBypruqxd-n4q6aZhyi58ucpeGTDWLiSXU8BQaH8"},a=await x.post("/saveSocialLogin",t);if(a.data&&a.data.success){const{token:l,customer:u}=a.data.data;l&&(localStorage.setItem("authToken",l),C(l)),localStorage.setItem("userData",JSON.stringify(u)),localStorage.setItem("userType","customer"),d.push("/personal-info")}else r.value=a.data.message||"Failed to create account."}catch(e){console.error("Save social account error:",e),r.value="Failed to create account."}};return(o,e)=>(g(),V(D,null,{default:M(()=>[s("div",J,[e[6]||(e[6]=s("h1",{class:"text-3xl font-bold text-gray-900 mb-4"},"Enter Your Mobile Number",-1)),s("p",K," Enter your mobile number to access your account and manage your "+b(I.value)+" easily. ",1)]),r.value?(g(),f("div",Y,b(r.value),1)):y("",!0),v.value?(g(),f("div",W,[s("div",Q,[e[8]||(e[8]=s("svg",{class:"h-5 w-5 text-yellow-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),s("div",null,[e[7]||(e[7]=s("p",{class:"font-medium"},"Account Not Found",-1)),s("p",X,b(v.value),1)])])])):y("",!0),s("form",{onSubmit:T(z,["prevent"]),class:"space-y-6"},[s("div",ee,[s("div",te,[G(Z,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t)},null,8,["modelValue"])]),O(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),onInput:e[2]||(e[2]=t=>i.value=i.value.replace(/[^0-9]/g,"")),type:"tel",inputmode:"numeric",pattern:"[0-9]*",placeholder:"7000 000000",class:"flex-1 min-w-0 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 text-lg",required:""},null,544),[[q,i.value]])]),s("button",{type:"submit",disabled:p.value,class:"w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white font-semibold py-4 px-6 rounded-lg transition-colors text-lg"},b(p.value?"Processing...":"Continue"),9,ae)],32),c.value==="customer"?(g(),f("div",oe,[...e[9]||(e[9]=[s("span",{class:"text-gray-500 bg-white px-4 relative z-10"},"OR",-1),s("div",{class:"absolute left-0 right-0 h-px bg-gray-300 top-1/2"},null,-1)])])):y("",!0),c.value==="customer"?(g(),f("div",se,[s("button",{onClick:e[3]||(e[3]=t=>h("apple")),class:"w-full flex items-center justify-center space-x-3 py-4 px-6 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},[...e[10]||(e[10]=[s("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"})],-1),s("span",{class:"text-gray-700 font-medium"},"Continue with Apple",-1)])]),s("button",{onClick:e[4]||(e[4]=t=>h("google")),class:"w-full flex items-center justify-center space-x-3 py-4 px-6 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},[...e[11]||(e[11]=[s("svg",{class:"w-5 h-5",viewBox:"0 0 24 24"},[s("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),s("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),s("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),s("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})],-1),s("span",{class:"text-gray-700 font-medium"},"Continue with Google",-1)])]),s("button",{onClick:e[5]||(e[5]=t=>h("facebook")),class:"w-full flex items-center justify-center space-x-3 py-4 px-6 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},[...e[12]||(e[12]=[s("svg",{class:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})],-1),s("span",{class:"text-gray-700 font-medium"},"Continue with Facebook",-1)])])])):y("",!0)]),_:1}))}};export{de as default};
