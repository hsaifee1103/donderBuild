import{l as q,r as n,b as J,f as d,o as r,j as z,a as e,E as $,g as x,t as p,i as _,B as F,F as M,p as H,v as y,k as b,u as G,e as K}from"./app-IgbZzkPW.js";import{o as Q,_ as X}from"./useOnboarding-Dx_EahNf.js";const Z={class:"page"},ee={class:"container"},se={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},te={class:"flex items-center mb-4"},ae={class:"space-y-3"},oe={class:"row"},le={class:"left"},ie=["for"],ne={class:"right"},de={class:"switch"},re=["id","onUpdate:modelValue"],ue={key:0,class:"time-row"},ce={class:"times"},ve=["onUpdate:modelValue"],me=["onUpdate:modelValue"],pe={key:1,class:"time-row"},_e={class:"mt-8"},fe={class:"flex justify-between items-center mb-4"},ye={key:0,class:"muted"},be={key:1,class:"muted"},ge={key:2,class:"space-y-3"},he={class:"font-medium"},ke={class:"text-sm text-gray-600"},we={class:"flex gap-2"},xe=["onClick"],Ce=["onClick"],Se={key:1,class:"overlay"},De={class:"modal"},Ee={class:"title-sm mb-4"},Pe={class:"space-y-4"},Ue={class:"flex justify-end gap-2 mt-6"},Be=["disabled"],Ve={key:2,class:"overlay"},Ae={class:"modal"},$e={class:"flex justify-end gap-2"},Fe=["disabled"],Me={__name:"SignupBusinessHours",setup(He){const P=G();K();const{step:N,totalSteps:T,nextStep:L}=Q(),C=n(!0),U=n(!1),u=n("");n(!1);const f=n([]),S=n(!1),g=n(!1),h=n(!1),D=n(!1),m=n(!1),k=n(!1),i=n({id:null,start_date:"",end_date:"",description:""}),w=n(-1),B=n([{id:"mon",name:"Monday",is_active:!0,open_time:"05:00",close_time:"10:00",day:"Monday"},{id:"tue",name:"Tuesday",is_active:!0,open_time:"05:00",close_time:"10:00",day:"Tuesday"},{id:"wed",name:"Wednesday",is_active:!1,open_time:"09:00",close_time:"17:00",day:"Wednesday"},{id:"thu",name:"Thursday",is_active:!1,open_time:"09:00",close_time:"17:00",day:"Thursday"},{id:"fri",name:"Friday",is_active:!1,open_time:"09:00",close_time:"17:00",day:"Friday"},{id:"sat",name:"Saturday",is_active:!1,open_time:"09:00",close_time:"17:00",day:"Saturday"},{id:"sun",name:"Sunday",is_active:!1,open_time:"09:00",close_time:"17:00",day:"Sunday"}]);function I(l,t){const a={weekday:"short",month:"short",day:"numeric"},o=new Date(l).toLocaleDateString("en-US",a),s=new Date(t).toLocaleDateString("en-US",a),c=new Date(l).getFullYear();return`${o} - ${s}, ${c}`}async function E(){var l,t,a,o;S.value=!0,u.value="";try{const s=await b.get("/business-holiday");if((l=s.data)!=null&&l.success)f.value=s.data.data||[];else throw new Error(((t=s.data)==null?void 0:t.message)||"Failed to fetch closed periods.")}catch(s){console.error("Error fetching closed periods:",s),u.value=(s==null?void 0:s.message)||((o=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:o.message)||"An unexpected error occurred while fetching closed periods."}finally{S.value=!1}}function j(l){w.value=l,i.value={...f.value[l]},m.value=!0}function O(l){w.value=l,k.value=!0}function V(){D.value=!1,m.value=!1,i.value={id:null,start_date:"",end_date:"",description:""},w.value=-1}async function W(){var l,t,a,o;if(!i.value.start_date||!i.value.end_date){u.value="Start date and end date are required";return}if(new Date(i.value.start_date)>new Date(i.value.end_date)){u.value="End date must be after start date";return}g.value=!0,u.value="";try{let s;const c={start_date:i.value.start_date,end_date:i.value.end_date,description:i.value.description};if(m.value&&i.value.id?(c.holiday_id=i.value.id,s=await b.put("/business-holiday",c)):s=await b.post("/business-holiday",c),!((l=s.data)!=null&&l.success))throw new Error(((t=s.data)==null?void 0:t.message)||"Failed to save closed period.");await E(),V()}catch(s){console.error("Error saving closed period:",s),u.value=(s==null?void 0:s.message)||((o=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:o.message)||"An unexpected error occurred while saving the closed period."}finally{g.value=!1}}async function A(){var l,t,a,o;if(!i.value.id){u.value="Invalid period ID";return}h.value=!0,u.value="";try{const s={holiday_id:i.value.id},c=await b.delete("/business-holiday",{data:s});if(!((l=c.data)!=null&&l.success))throw new Error(((t=c.data)==null?void 0:t.message)||"Failed to delete closed period.");await E(),k.value=!1,m.value=!1,w.value=-1}catch(s){console.error("Error deleting closed period:",s),u.value=(s==null?void 0:s.message)||((o=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:o.message)||"An unexpected error occurred while deleting the closed period."}finally{h.value=!1}}async function R(){var l,t,a,o;U.value=!0,u.value="";try{const s={days:B.value.map(v=>({day:v.id,open_time:v.is_active?v.open_time:"00:00",close_time:v.is_active?v.close_time:"00:00",is_active:v.is_active})),holidays:f.value.map(v=>v.id),isBankHoliday:C.value};localStorage.setItem("onboarding-hours",JSON.stringify(s));const c=await b.post("/business-day",s);if(!((l=c.data)!=null&&l.success))throw new Error(((t=c.data)==null?void 0:t.message)||"Failed to save business hours.");L(),P.push({name:"SignupBusinessDesc"})}catch(s){console.error("Error saving business hours:",s),u.value=(s==null?void 0:s.message)||((o=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:o.message)||"An unexpected error occurred."}finally{U.value=!1}}function Y(){P.back()}return J(()=>{E()}),(l,t)=>(r(),d("div",Z,[z(X,{step:$(N),"total-steps":$(T),onBack:Y,onContinue:R},null,8,["step","total-steps"]),e("main",ee,[t[16]||(t[16]=e("section",{class:"lead"},[e("p",{class:"eyebrow"},"ACCOUNT SETUP"),e("h1",{class:"title"},"When Are You Open Your Business?"),e("p",{class:"subtitle"},"Configure the standard hours of operation for this location.")],-1)),u.value?(r(),d("div",se,p(u.value),1)):x("",!0),e("div",te,[_(e("input",{id:"bankHolidays","onUpdate:modelValue":t[0]||(t[0]=a=>C.value=a),type:"checkbox",class:"checkbox"},null,512),[[F,C.value]]),t[6]||(t[6]=e("label",{for:"bankHolidays",class:"ml-3 text-gray-700"},"Enable Bank Holidays",-1))]),e("div",ae,[(r(!0),d(M,null,H(B.value,a=>(r(),d("div",{key:a.id,class:"day-container"},[e("div",oe,[e("div",le,[e("label",{for:`day-${a.id}`,class:"font-medium"},p(a.name),9,ie)]),e("div",ne,[e("label",de,[_(e("input",{id:`day-${a.id}`,"onUpdate:modelValue":o=>a.is_active=o,type:"checkbox"},null,8,re),[[F,a.is_active]]),t[7]||(t[7]=e("span",{class:"slider round"},null,-1))])])]),a.is_active?(r(),d("div",ue,[e("div",ce,[_(e("input",{"onUpdate:modelValue":o=>a.open_time=o,type:"time",class:"time"},null,8,ve),[[y,a.open_time]]),t[8]||(t[8]=e("span",{class:"to"},"to",-1)),_(e("input",{"onUpdate:modelValue":o=>a.close_time=o,type:"time",class:"time"},null,8,me),[[y,a.close_time]])])])):(r(),d("div",pe,[...t[9]||(t[9]=[e("div",{class:"closed"},"Closed",-1)])]))]))),128))]),e("div",_e,[e("div",fe,[t[10]||(t[10]=e("h2",{class:"title-sm"},"Closed Periods",-1)),e("button",{class:"btn",onClick:t[1]||(t[1]=a=>D.value=!0)},"Add Closed Period")]),S.value?(r(),d("div",ye," Loading closed periods... ")):f.value.length===0?(r(),d("div",be," No closed periods have been added. ")):(r(),d("div",ge,[(r(!0),d(M,null,H(f.value,(a,o)=>(r(),d("div",{key:a.id,class:"period"},[e("div",null,[e("div",he,p(I(a.start_date,a.end_date)),1),e("div",ke,p(a.description),1)]),e("div",we,[e("button",{class:"btn-plain",onClick:s=>j(o)},"Edit",8,xe),e("button",{class:"btn-secondary",onClick:s=>O(o)},"Delete",8,Ce)])]))),128))]))]),D.value||m.value?(r(),d("div",Se,[e("div",De,[e("h3",Ee,p(m.value?"Edit Closed Period":"Add Closed Period"),1),e("div",Pe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Start date*",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>i.value.start_date=a),type:"date",class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[y,i.value.start_date]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"End date*",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>i.value.end_date=a),type:"date",class:"w-full p-2 border border-gray-300 rounded-md"},null,512),[[y,i.value.end_date]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>i.value.description=a),type:"text",class:"w-full p-2 border border-gray-300 rounded-md",placeholder:"e.g. National Holiday"},null,512),[[y,i.value.description]])])]),e("div",Ue,[e("button",{class:"btn-plain",onClick:V},"Cancel"),m.value?(r(),d("button",{key:0,class:"btn-secondary",onClick:A},"Delete")):x("",!0),e("button",{class:"btn",onClick:W,disabled:g.value},p(g.value?"Saving...":"Save"),9,Be)])])])):x("",!0),k.value?(r(),d("div",Ve,[e("div",Ae,[t[14]||(t[14]=e("h3",{class:"title-sm mb-2"},"Confirm Deletion",-1)),t[15]||(t[15]=e("p",{class:"mb-4"},"Are you sure you want to delete this closed period?",-1)),e("div",$e,[e("button",{class:"btn-plain",onClick:t[5]||(t[5]=a=>k.value=!1)},"Cancel"),e("button",{class:"btn-secondary",onClick:A,disabled:h.value},p(h.value?"Deleting...":"Delete"),9,Fe)])])])):x("",!0)])]))}},Le=q(Me,[["__scopeId","data-v-8c20b5d5"]]);export{Le as default};
