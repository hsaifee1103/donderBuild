import{l as P,D as G,d as C,r as A,f as d,o as u,g as p,j as H,a as e,t as c,h as J,i as g,n as v,v as _,H as U,E as X,R as K,F as Q,k as B,I as W}from"./app-IgbZzkPW.js";const Z={key:0,class:"page"},ee={class:"container"},te={class:"lead"},ie={class:"title text-start"},ae={class:"field"},se={key:0,class:"error-text"},re={class:"field"},oe={key:0,class:"error-text"},le={class:"field"},ne={key:0,class:"error-text"},de={class:"field"},ue={class:"with-icon"},ce={key:0,class:"error-text"},me={class:"field"},fe={class:"with-icon"},pe={key:0,class:"error-text"},ge={class:"field"},ve={class:"with-icon"},ye=["max"],be={key:0,class:"error-text"},he={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},_e={class:"flex items-start"},ke={class:"text-sm"},xe={class:"form-actions"},Ne=["disabled"],Me={__name:"AddVehicleForm",props:{isVisible:{type:Boolean,default:!1},errorMessage:{type:String,default:null},formData:{type:Object,default:()=>({})}},emits:["close","submit"],setup(M,{emit:$}){var w,O,D,V,z,R,F,q;const l=M,S=$,k=new Date().getFullYear(),i=G({registrationNumber:((w=l.formData)==null?void 0:w.registrationNumber)||"",postcode:((O=l.formData)==null?void 0:O.postcode)||"Not required",engineSize:((D=l.formData)==null?void 0:D.engineSize)||"",transmission:((V=l.formData)==null?void 0:V.transmission)||"",fuelType:((z=l.formData)==null?void 0:z.fuelType)||"",yearOfRegistration:((R=l.formData)==null?void 0:R.yearOfRegistration)||"",carModel:((F=l.formData)==null?void 0:F.carModel)||"",car_id:((q=l.formData)==null?void 0:q.car_id)||null}),x=C(()=>l.formData.car_id),j=async()=>{var r,t;if(!(!L()||y.value)){y.value=!0,a.value={};try{const s=Y();if(!s)throw new Error("User not authenticated");const b={postcode:i.postcode,car_make:i.carModel,car_model:i.registrationNumber,engine_size:i.engineSize,fuelType:i.fuelType,yearOfManufacture:i.yearOfRegistration,user_id:s,transmission:i.transmission};let o;if(x.value?(b.car_id=i.car_id,o=await B.post("/update-car-details",b)):o=await B.post("/car_details",b),o.data&&o.data.success)S("submit",{...i}),T(),W({type:"success",title:x.value?"Vehicle Updated Successfully":"Vehicle Added Successfully",message:o.data.message||(x.value?"Your vehicle details have been updated.":"Your vehicle has been added to your profile."),confirmButtonText:"Great!"});else if(o.data&&o.data.errors){const m=o.data.errors,n={};m.forEach(f=>{const N=f.match(/The (.+?) field/);if(N){const h=N[1],E={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[h];E?n[E]=f:n.general=n.general?`${n.general}; ${f}`:f}else n.general=n.general?`${n.general}; ${f}`:f}),a.value=n}else a.value.general=((r=o.data)==null?void 0:r.message)||"Failed to submit vehicle details. Please try again."}catch(s){if(console.error("Error submitting vehicle form:",s),s.response)if(s.response.status===422){const b=s.response.data.errors||[],o={};b.forEach(m=>{const n=m.match(/The (.+?) field/);if(n){const f=n[1],h={postcode:"postcode",car_make:"carModel",car_model:"registrationNumber",engine_size:"engineSize",fuelType:"fuelType",yearOfManufacture:"yearOfRegistration",transmission:"transmission"}[f];h?o[h]=m:o.general=o.general?`${o.general}; ${m}`:m}else o.general=o.general?`${o.general}; ${m}`:m}),a.value=o}else a.value.general=((t=s.response.data)==null?void 0:t.message)||"Server error occurred";else s.request?a.value.general="Network error. Please check your connection.":a.value.general=s.message||"An unexpected error occurred"}finally{y.value=!1}}},y=A(!1),a=A({}),Y=()=>{const r=localStorage.getItem("userData");return r?JSON.parse(r).id:null},I=C(()=>!!i.registrationNumber&&!!i.engineSize&&!!i.transmission&&!!i.fuelType&&!!i.yearOfRegistration&&!!i.carModel),L=()=>{const r={};return i.registrationNumber||(r.registrationNumber="Registration number is required"),i.engineSize||(r.engineSize="Engine size is required"),i.transmission?["manual","automatic"].includes(i.transmission)||(r.transmission="Transmission must be manual or automatic"):r.transmission="Transmission is required",i.fuelType?["petrol","diesel"].includes(i.fuelType)||(r.fuelType="Fuel type must be petrol or diesel"):r.fuelType="Fuel type is required",i.yearOfRegistration?(i.yearOfRegistration<1900||i.yearOfRegistration>k)&&(r.yearOfRegistration=`Year must be between 1900 and ${k}`):r.yearOfRegistration="Year of registration is required",i.carModel||(r.carModel="Car model is required"),a.value=r,Object.keys(r).length===0},T=()=>{S("close"),Object.keys(i).forEach(r=>{i[r]=""}),a.value={}};return(r,t)=>(u(),d(Q,null,[M.isVisible?(u(),d("div",Z,[e("div",ee,[e("section",te,[e("h1",ie,c(l.formData.car_id?"Edit":"Add")+" Your Car Details",1)]),e("form",{class:"form",onSubmit:J(j,["prevent"])},[e("label",ae,[t[6]||(t[6]=e("span",null,[v("Registration Number "),e("b",{"aria-hidden":"true"},"*")],-1)),g(e("input",{id:"registrationNumber","onUpdate:modelValue":t[0]||(t[0]=s=>i.registrationNumber=s),type:"text",placeholder:"e.g. AB12 CDE",required:""},null,512),[[_,i.registrationNumber,void 0,{trim:!0}]]),a.value.registrationNumber?(u(),d("small",se,c(a.value.registrationNumber),1)):p("",!0)]),e("label",re,[t[7]||(t[7]=e("span",null,[v("Car Make "),e("b",{"aria-hidden":"true"},"*")],-1)),g(e("input",{id:"carModel","onUpdate:modelValue":t[1]||(t[1]=s=>i.carModel=s),type:"text",placeholder:"e.g. Fiesta, Corolla, X5",required:""},null,512),[[_,i.carModel,void 0,{trim:!0}]]),a.value.carModel?(u(),d("small",oe,c(a.value.carModel),1)):p("",!0)]),e("label",le,[t[8]||(t[8]=e("span",null,[v("Engine Size "),e("b",{"aria-hidden":"true"},"*")],-1)),g(e("input",{id:"engineSize","onUpdate:modelValue":t[2]||(t[2]=s=>i.engineSize=s),type:"text",placeholder:"e.g. 1.6L",required:""},null,512),[[_,i.engineSize,void 0,{trim:!0}]]),a.value.engineSize?(u(),d("small",ne,c(a.value.engineSize),1)):p("",!0)]),e("label",de,[t[11]||(t[11]=e("span",null,[v("Transmission "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",ue,[g(e("select",{id:"transmission","onUpdate:modelValue":t[3]||(t[3]=s=>i.transmission=s),required:""},[...t[9]||(t[9]=[e("option",{value:""},"Select transmission",-1),e("option",{value:"manual"},"Manual",-1),e("option",{value:"automatic"},"Automatic",-1)])],512),[[U,i.transmission]]),t[10]||(t[10]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),a.value.transmission?(u(),d("small",ce,c(a.value.transmission),1)):p("",!0)]),e("label",me,[t[14]||(t[14]=e("span",null,[v("Fuel Type "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",fe,[g(e("select",{id:"fuelType","onUpdate:modelValue":t[4]||(t[4]=s=>i.fuelType=s),required:""},[...t[12]||(t[12]=[e("option",{value:""},"Select fuel type",-1),e("option",{value:"petrol"},"Petrol",-1),e("option",{value:"diesel"},"Diesel",-1)])],512),[[U,i.fuelType]]),t[13]||(t[13]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),a.value.fuelType?(u(),d("small",pe,c(a.value.fuelType),1)):p("",!0)]),e("label",ge,[t[16]||(t[16]=e("span",null,[v("Year of Registration "),e("b",{"aria-hidden":"true"},"*")],-1)),e("div",ve,[g(e("input",{id:"yearOfRegistration","onUpdate:modelValue":t[5]||(t[5]=s=>i.yearOfRegistration=s),type:"number",min:"1900",max:X(k),placeholder:"e.g. 2020",required:""},null,8,ye),[[_,i.yearOfRegistration]]),t[15]||(t[15]=e("svg",{class:"trailing",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor","stroke-width":"2"})],-1))]),a.value.yearOfRegistration?(u(),d("small",be,c(a.value.yearOfRegistration),1)):p("",!0)]),a.value.general?(u(),d("div",he,[e("div",_e,[t[18]||(t[18]=e("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("div",null,[t[17]||(t[17]=e("p",{class:"font-medium"},"Error",-1)),e("p",ke,c(a.value.general),1)])])])):p("",!0),e("div",xe,[e("button",{type:"button",onClick:T,class:"cancel-btn"}," Cancel "),e("button",{type:"submit",class:"submit-btn",disabled:!I.value||y.value},c(y.value?l.formData.car_id?"Updating Vehicle...":"Adding Vehicle...":l.formData.car_id?"Update Vehicle":"Add Vehicle"),9,Ne)])],32)])])):p("",!0),H(K)],64))}},we=P(Me,[["__scopeId","data-v-bd95a457"]]);export{we as A};
