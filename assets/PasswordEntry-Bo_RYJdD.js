import{r as l,d as w,e as M,b as T,c as B,o as y,w as x,u as P,m as z,a as t,f as b,g as I,t as f,h as V,i as E,q as U,x as j,j as H,n as O,k as _,y as J}from"./app-C7zuiOEw.js";import{_ as F}from"./AuthLayout-BVnhtO7e.js";const G={class:"w-full max-w-md mx-auto"},R={class:"text-center mb-8"},W={class:"text-2xl font-bold text-gray-900 mb-4"},Y={key:0,class:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg"},Z={class:"flex items-start"},$={class:"text-sm"},K={class:"relative"},Q=["type"],X={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ee={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},oe={class:"text-center"},te=["disabled"],ae={__name:"PasswordEntry",props:{userType:{type:String,required:!0}},setup(q){const r=M(),h=P(),i=q,u=l(""),d=l(!1),c=l(!1),k=l("User"),s=l(""),p=l("+44"),v=l(""),C=l("eOJLsFzYdUeimHNV8fY_m8:APA91bHiKHyu4IZdPLIPuAcUeWw_85-ieyNT3oRvFHMbVeL9_nG7zCpi51eEvyybZiN8GEsHxOvzlvuVBypruqxd-n4q6aZhyi58ucpeGTDWLiSXU8BQaH8"),m=l(null),L=w(()=>i.userType==="customer"?"Customer":"Garage"),N=w(()=>r.query.contact||""),S=()=>{d.value=!d.value},A=w(()=>{const a={};return v.value&&(a.mobile=v.value),p.value&&(a.countryCode=p.value),{path:`/${i.userType}/forgot-password`,query:a}}),D=async()=>{var a;if(u.value){c.value=!0,s.value="";try{const e={country_code:p.value,mobile:v.value||N.value,password:u.value,fcm_token:C.value};console.log("Attempting login with data:",e);const n=i.userType==="garage"?"/provider/login":"/customer-login",o=await _.post(n,e);if(console.log("Login response:",o.data),o.data&&o.data.success){const g=o.data.data.token||o.data.access_token;g&&(localStorage.setItem("authToken",g),_.setAuthToken(g)),o.data.data.customer?(localStorage.setItem("userData",JSON.stringify(o.data.data.customer)),await J()):m.value&&localStorage.setItem("userData",JSON.stringify(m.value)),o.data.data.provider&&localStorage.setItem("userData",JSON.stringify(o.data.data.provider)),console.log("User data stored:",m.value),i.userType,h.push("/")}else o.data&&o.data.errors&&Array.isArray(o.data.errors)?s.value=o.data.errors.join(", "):s.value=((a=o.data)==null?void 0:a.message)||"Login failed. Please check your credentials."}catch(e){if(console.error("Login error:",e),e.response){const n=e.response.status,o=e.response.data;n===422?o.errors&&Array.isArray(o.errors)?s.value=o.errors.join(", "):s.value="Invalid mobile or password.":n===401?s.value="Invalid mobile or password.":s.value=o.message||"An error occurred during login."}else e.request?s.value="Network error. Please check your connection.":s.value="An unexpected error occurred."}finally{c.value=!1}}};return T(()=>{if(r.query.userName&&(k.value=r.query.userName),r.query.mobile&&(v.value=r.query.mobile),r.query.countryCode&&(p.value=r.query.countryCode),r.query.userData)try{m.value=JSON.parse(r.query.userData)}catch(a){console.error("Error parsing user data:",a)}}),(a,e)=>{const n=z("router-link");return y(),B(F,null,{default:x(()=>[t("div",G,[t("div",R,[t("h1",W," Welcome Back to Your "+f(L.value)+" Account, "+f(k.value),1),e[1]||(e[1]=t("p",{class:"text-gray-600"}," Enter your password to access your account and manage your car services easily. ",-1))]),s.value?(y(),b("div",Y,[t("div",Z,[e[3]||(e[3]=t("svg",{class:"h-5 w-5 text-red-500 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("div",null,[e[2]||(e[2]=t("p",{class:"font-medium"},"Login Failed",-1)),t("p",$,f(s.value),1)])])])):I("",!0),t("form",{onSubmit:V(D,["prevent"]),class:"space-y-6"},[t("div",K,[E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),type:d.value?"text":"password",placeholder:"Enter password",class:U(["w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-colors",{"border-red-500":s.value}]),required:""},null,10,Q),[[j,u.value]]),t("button",{type:"button",onClick:S,class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"},[d.value?(y(),b("svg",X,[...e[4]||(e[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L8.464 8.464m1.414 1.414L8.464 8.464m5.656 5.656l1.415 1.415m-1.415-1.415l1.415 1.415M14.828 14.828L16.243 16.243"},null,-1)])])):(y(),b("svg",ee,[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))])]),t("div",oe,[H(n,{to:A.value,class:"text-red-500 hover:text-red-600 text-sm font-medium"},{default:x(()=>[...e[6]||(e[6]=[O(" Forgot your password? ",-1)])]),_:1},8,["to"])]),t("button",{type:"submit",disabled:c.value||!u.value,class:"w-full bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white font-semibold py-3 px-4 rounded-lg transition-colors"},f(c.value?"Signing In...":"Continue"),9,te)],32)])]),_:1})}}};export{ae as default};
